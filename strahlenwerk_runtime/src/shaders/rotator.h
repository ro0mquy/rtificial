#ifndef rotator_H
#define rotator_H
const char rotator_source[] =#version 430
layout((location=234))uniform vec3 v;layout((location=235))uniform float m;layout((location=64))uniform float f;layout((location=65))uniform float e;layout((location=117))uniform float y;
#line 3"fragment"
out vec3 r;out float M;layout((location=0))uniform vec2 x;layout((location=66))uniform float i;
#line 2"quat_rotate"
vec3 l[12]=vec3[12](vec3(1,1,0),vec3(-1,1,0),vec3(1,-1,0),vec3(-1,-1,0),vec3(1,0,1),vec3(-1,0,1),vec3(1,0,-1),vec3(-1,0,-1),vec3(0,1,1),vec3(0,-1,1),vec3(0,1,-1),vec3(0,-1,-1));
#line 4"camera"
layout((location=67))uniform vec3 z;layout((location=68))uniform vec4 s;layout((location=69))uniform float a;layout((location=70))uniform float c;float n=a/c;
#line 2"helper"
const float d=3.14159,t=6.28319,g=2.71828,S=1.61803,p=1000.,b=1./0.;
#line 4"sdf/domain"
#line 3"sdf/operators"
#line 4"material"
struct MaterialId{float id;vec3 coord;vec4 misc;};struct MatWrap{float f;MaterialId m;};struct Material{vec3 color;float roughness;float metallic;float height;vec3 emission;};bool u=false;float w=p;MaterialId o=MaterialId(0.,vec3(0.),vec4(0.));
#line 5"sdf/distances"
#line 4"lighting"
layout((binding=0))uniform sampler2D h;layout((binding=1))uniform samplerCube k;layout((binding=2))uniform samplerCube q;layout((binding=3))uniform samplerCube W;struct SphereLight{vec3 position;float radius;vec3 color;float power;};
#line 11"march"
layout((location=132))uniform float I;layout((location=133))uniform float L;layout((location=134))uniform vec3 F;layout((location=135))uniform float C;const float D=423.;bool Z=true,Y=false,X=false,V=false,U=false,T=false,R=false,Q=Z,P=Y;layout((location=136))uniform float O;
#line 4"rotator"
void N(inout vec3 f,vec4 v){vec3 y=2*cross(v.xyz,f);f+=v.w*y+cross(v.xyz,y);}uint N(uint f){return f=f+2127912214+(f<<12),f=f^-949894596^f>>19,f=f+374761393+(f<<5),f=f+-744332180^f<<9,f=f+-42973499+(f<<3),f=f^-1252372727^f>>16,f;}float K(uint v){return float(v%(1<<20))/float(1<<20);}float J(int v){return K(N(v));}float H(ivec2 v){return K(N(v.x+N(v.y)));}float G(ivec3 v){return K(N(v.x+N(v.y+N(v.z))));}float E(float v){int f=int(floor(v));float y=fract(v),i=G(f),e=G(f+1);return mix(i,e,y);}float B(vec2 v){ivec2 f=ivec2(floor(v));vec2 b=fract(v);float m=0,i=G(f),e=G(f+ivec2(0,1)),x=G(f+ivec2(1,0)),z=G(f+ivec2(1,1));return mix(mix(i,x,b.x),mix(e,z,b.x),b.y)*2.-1.;}float A(vec3 v){ivec3 f=ivec3(floor(v));vec3 b=fract(v);float m=0,i=G(f),e=G(f+ivec3(0,1,0)),x=G(f+ivec3(1,0,0)),z=G(f+ivec3(1,1,0)),y=G(f+ivec3(0,0,1)),M=G(f+ivec3(0,1,1)),n=G(f+ivec3(1,0,1)),Y=G(f+ivec3(1,1,1));return mix(mix(mix(i,x,b.x),mix(e,z,b.x),b.y),mix(mix(y,n,b.x),mix(M,Y,b.x),b.y),b.z)*2.-1.;}float j(vec2 f){float y=.5*(sqrt(3.)-1.);ivec2 v=ivec2(floor(f+(f.x+f.y)*y));float x=(3.-sqrt(3.))/6.;f-=v-(v.x+v.y)*x;ivec2 b=f.x>f.y?ivec2(1,0):ivec2(0,1);vec2 a[3]=vec2[3](f,f-b+x,f-1.+2.*x);ivec3 i=ivec3(v.x)+ivec3(0,b.x,1),M=ivec3(v.y)+ivec3(0,b.y,1);float r=0;for(uint m=0;m<3;m++){float c=max(0,.5-a[m].x*a[m].x-a[m].y*a[m].y);c*=c;uint n=N(i[m]+N(M[m]))%12;r+=c*c*dot(l[n].xy,a[m]);}return 70.*r;}float ab(vec3 f){float y=1./3.,v=1./6.;ivec3 m=ivec3(floor(f+(f.x+f.y+f.z)*y));f-=m-(m.x+m.y+m.z)*v;vec3 x=step(f.yzx,f);ivec3 b=ivec3(min(x,(1.-x).zxy)),s=ivec3(max(x,(1.-x).zxy));vec3 a[4]=vec3[4](f,f-b+v,f-s+2.*v,f-1.+3.*v);int i[4]=int[4](m.x,m.x+b.x,m.x+s.x,m.x+1),M[4]=int[4](m.y,m.y+b.y,m.y+s.y,m.y+1),d[4]=int[4](m.z,m.z+b.z,m.z+s.z,m.z+1);float r=0;for(uint c=0;c<4;c++){float e=max(0.,.6-a[c].x*a[c].x-a[c].y*a[c].y-a[c].z*a[c].z);e*=e;uint n=N(i[c]+N(M[c]+N(d[c])))%12;r+=e*e*dot(l[n],a[c]);}return 32.*r;}float ac(vec2 f){float v=0.;for(int r=0;r<3;r++)v+=exp2(-r)*A(f),f*=2.;return v/1.75;}float ad(vec3 f){float v=0.;for(int r=0;r<3;r++)v+=exp2(-r)*A(f),f*=2.;return v/1.75;}float ae(vec2 f){float v=0.;for(int r=0;r<3;r++)v+=exp2(-r)*ab(f),f*=2.;return v/1.75;}float af(vec3 f){float v=0.;for(int r=0;r<3;r++)v+=exp2(-r)*ab(f),f*=2.;return v/1.75;}vec3 A(vec2 v,out float r){vec3 f=vec3((v-.5*x)/x.x,a/c);r=length(f.xz);f=normalize(f);return f;}vec3 A(){vec2 v=vec2(ab(vec2(i*e,23)),ab(vec2(i*e,283)))*f;vec3 r=A(gl_FragCoord.xy+v*x,n);r.z=-r.z;N(r,s);return r;}float ag(float v){return.5*v/(n*x.x);}float ah(vec2 f){return min(f.x,f.y);}float ai(vec3 f){return min(min(f.x,f.y),f.z);}float aj(vec2 f){return max(f.x,f.y);}float ak(vec3 f){return max(max(f.x,f.y),f.z);}float A(float v,float f,float y){return min(min(v,f),y);}float A(float v,float f,float y,float b){return min(min(min(v,f),y),b);}float B(float v,float f,float y){return max(max(v,f),y);}float B(float v,float f,float y,float b){return max(max(max(v,f),y),b);}float al(vec2 v){return v.x+v.y;}float am(vec3 v){return v.x+v.y+v.z;}float an(vec2 v){return v.x*v.y;}float ao(vec3 v){return v.x*v.y*v.z;}float ap(float v){return v*v;}vec2 aq(vec2 v){return v*v;}vec3 ar(vec3 v){return v*v;}float as(float v){return 1./v;}vec2 at(vec2 v){return 1./v;}vec3 au(vec3 v){return 1./v;}float B(vec2 v,float f){return pow(am(pow(abs(v),vec2(f))),1./f);}float E(vec3 v,float f){return pow(am(pow(abs(v),vec3(f))),1./f);}float av(float v){return clamp(v,0.,1.);}vec2 aw(vec2 v){return clamp(v,0.,1.);}vec3 ax(vec3 v){return clamp(v,0.,1.);}float E(float v,float f,float y){return clamp((y-v)/(f-v),0.,1.);}float G(float v,float f,float y){float i=clamp((y-v)/(f-v),0.,1.);return i*i*i*(i*(i*6.-15.)+10.);}float G(vec2 v,vec2 f){return max(0.,dot(v,f));}float H(vec3 v,vec3 f){return max(0.,dot(v,f));}float ay(float v){return v<0.?-1.:1.;}vec2 az(vec2 f){return vec2(f.x<0.?-1.:1.,f.y<0.?-1.:1.);}vec3 ba(vec3 f){return vec3(f.x<0.?-1.:1.,f.y<0.?-1.:1.,f.z<0.?-1.:1.);}vec2 bb(float v){return vec2(cos(v),sin(v));}vec3 J(float v,float f){float b=cos(f),y=sin(v),i=sin(f),x=cos(v);return vec3(i*x,b,i*y);}float H(float v,float f,float m){if(m>v)return m;float i=2.*f-v,y=2.*v-3.*f,x=m/v;return(i*x+y)*x*x+f;}float K(float v,float y){float f=v*y;return f*exp(1.-f);}float J(float v,float f,float y){return y=abs(y-v),y/=f,1.-smoothstep(0.,1.,y);}float K(float v,float f,float y){return exp(-v*pow(y,f));}float ab(float f,float v){return pow(4.*v*(1.-v),f);}float N(float f,float v,float y){float o=pow(f+v,f+v)/(pow(f,f)*pow(v,v));return o*pow(y,f)*pow(1.-y,v);}float ab(float f,float v,float y){return pow(y,f)*pow(1.-y,v);}float bc(vec3 v){return dot(v,vec3(.2126,.7152,.0722));}vec3 bd(vec3 f){vec4 v=vec4(0.,-1./3.,2./3.,-1.),i=mix(vec4(f.zy,v.wz),vec4(f.yz,v.xy),step(f.z,f.y)),m=mix(vec4(i.xyw,f.x),vec4(f.x,i.yzx),step(i.x,f.x));float b=m.x-min(m.w,m.y),y=1e-10;return vec3(abs(m.z+(m.w-m.y)/(6.*b+y)),b/(m.x+y),m.x);}vec3 be(vec3 f){vec4 v=vec4(1.,2./3.,1./3.,3.);vec3 i=abs(fract(f.xxx+v.xyz)*6.-v.www);return f.z*mix(v.xxx,clamp(i-v.xxx,0.,1.),f.y);}void ac(inout float v,float f){v-=f;}void ad(inout vec2 v,vec2 f){v-=f;}void ac(inout vec2 v,float f,float y){E(v,vec2(f,y));}void ae(inout vec3 v,vec3 f){v-=f;}void E(inout vec3 v,float f,float b,float y){E(v,vec3(f,b,y));}void af(inout vec2 v,float f){v*=mat2(cos(f),sin(f),-sin(f),cos(f));}void ag(inout vec3 v,float f){af(v.yz,f);}void ah(inout vec3 v,float f){af(v.zx,f);}void ai(inout vec3 v,float f){af(v.xy,f);}float aj(inout float v,float f){v+=.5*f;float o=floor(v/f);v=mod(v,f)-.5*f;return o;}vec2 ak(inout vec2 v,vec2 f){v+=.5*f;vec2 o=floor(v/f);v=mod(v,f)-.5*f;return o;}vec2 ad(inout vec2 v,float f,float y){return G(v,vec2(f,y));}vec3 al(inout vec3 v,vec3 f){v+=.5*f;vec3 o=floor(v/f);v=mod(v,f)-.5*f;return o;}vec3 G(inout vec3 v,float f,float b,float y){return G(v,vec3(f,b,y));}void am(inout float v,float f){v*=mod(f,2.)*2.-1.;}void an(inout vec2 v,vec2 f){v*=mod(f,2.)*2.-1.;}void ao(inout vec3 v,vec3 f){v*=mod(f,2.)*2.-1.;}float ap(inout float v,float f){float i=G(v,f);v*=mod(i,2.)*2.-1.;return i;}vec2 aq(inout vec2 v,vec2 f){vec2 i=G(v,f);v*=mod(i,2.)*2.-1.;return i;}vec3 ar(inout vec3 v,vec3 f){vec3 i=G(v,f);v*=mod(i,2.)*2.-1.;return i;}vec2 as(inout vec2 v,vec2 f){vec2 y=ar(v,f);v-=.5*f;if(v.x>v.y)v.xy=v.yx;return floor(.5*y);}vec3 at(inout vec3 v,vec3 f){vec3 y=ar(v,f);v-=.5*f;if(v.x<v.y){if(v.y>v.z){if(v.x<v.z)v=v.xzy;else v=v.zxy;}}else{if(v.z<v.y)v=v.zyx;else{if(v.z<v.x)v=v.yzx;else v=v.yxz;}}return floor(.5*y);}float au(inout float f,float v){float y=.5*v,o=0.;if(f>y)f+=y,o=floor(f/v),f=mod(f,v)-y;return o;}vec2 av(inout vec2 v,vec2 f){vec2 m=.5*f,o=vec2(0.);if(v.x>m.x)v.x+=m.x,o.x=floor(v.x/f.x),v.x=mod(v.x,f.x)-m.x;if(v.y>m.y)v.y+=m.y,o.y=floor(v.y/f.y),v.y=mod(v.y,f.y)-m.y;return o;}vec3 aw(inout vec3 v,vec3 f){vec3 m=.5*f,o=vec3(0.);if(v.x>m.x)v.x+=m.x,o.x=floor(v.x/f.x),v.x=mod(v.x,f.x)-m.x;if(v.y>m.y)v.y+=m.y,o.y=floor(v.y/f.y),v.y=mod(v.y,f.y)-m.y;if(v.z>m.z)v.z+=m.z,o.z=floor(v.z/f.z),v.z=mod(v.z,f.z)-m.z;return o;}float H(inout float v,float f,float y,float m){v+=.5*f;float i=floor(v/f);v=mod(v,f)-.5*f;if(i>m)v+=f*(i-m),i=m;else if(i<y)v+=f*(i-y),i=y;return i;}vec2 J(inout vec2 v,vec2 f,vec2 m,vec2 y){v+=.5*f;vec2 i=floor(v/f);v=mod(v,f)-.5*f;if(i.x>y.x)v.x+=f.x*(i.x-y.x),i.x=y.x;else if(i.x<m.x)v.x+=f.x*(i.x-m.x),i.x=m.x;if(i.y>y.y)v.y+=f.y*(i.y-y.y),i.y=y.y;else if(i.y<m.y)v.y+=f.y*(i.y-m.y),i.y=m.y;return i;}vec3 K(inout vec3 v,vec3 f,vec3 m,vec3 y){v+=.5*f;vec3 i=floor(v/f);v=mod(v,f)-.5*f;if(i.x>y.x)v.x+=f.x*(i.x-y.x),i.x=y.x;else if(i.x<m.x)v.x+=f.x*(i.x-m.x),i.x=m.x;if(i.y>y.y)v.y+=f.y*(i.y-y.y),i.y=y.y;else if(i.y<m.y)v.y+=f.y*(i.y-m.y),i.y=m.y;if(i.z>y.z)v.z+=f.z*(i.z-y.z),i.z=y.z;else if(i.z<m.z)v.z+=f.z*(i.z-m.z),i.z=m.z;return i;}float N(inout vec2 v,float f,float y,float m){float i=m,x=t/f,o=G(i,x),a=length(v);v=a*J(i);E(v.x,y);return o;}float ae(inout vec2 v,float f,float y){return N(v,f,y,atan(v.y,v.x));}float af(inout vec2 v,float f,float y){float i=length(v),o=floor(i/f);i=mod(i,f);v=i*J(y);return o;}float ax(inout vec2 v,float f){return af(v,f,atan(v.y,v.x));}float bf(inout float v){float f=ba(v);v=abs(v);return f;}vec2 bg(inout vec2 v){vec2 f=ba(v);v=abs(v);return f;}vec3 bh(inout vec3 v){vec3 f=ba(v);v=abs(v);return f;}float ay(inout float v,float f){float o=bh(v);E(v,f);return o;}vec2 az(inout vec2 v,vec2 f){vec2 y=bh(v);E(v,f);return y;}vec3 ba(inout vec3 v,vec3 f){vec3 y=bh(v);E(v,f);return y;}vec3 bb(inout vec2 v,vec2 f){vec3 r;r.xy=ba(v,f);if(v.y>v.x)r.z=-1.,v.xy=v.yx;else r.z=1.;return r;}vec3 bc(inout vec3 v,vec3 f){v=v.zyx;vec3 y=ba(v,f);if(v.x<v.y){if(v.y>v.z){if(v.x<v.z)v=v.xzy;else v=v.zxy;}}else{if(v.z<v.y)v=v.zyx;else{if(v.z<v.x)v=v.yzx;else v=v.yxz;}}v=v.zyx;return y;}vec2 bd(inout vec2 v,float f){vec2 y=v;bh(y);vec2 m=vec2(0);if(y.y>y.x)v=v.yx,m.x=1;m.y=ba(v.x,f);v.y*=m.y;return m;}vec2 be(inout vec3 v,float f){vec3 y=v;bh(y);vec2 m=vec2(0);if(y.z>y.x||y.y>y.x){if(y.y>y.z)v=v.yxz,m.x=1;else v=v.zyx,m.x=2;}m.y=ba(v.x,f);v.y*=m.y;return m;}float ag(inout vec3 v,vec3 f,float y){float i=dot(v,f)+y;if(i<0.)v-=2.*i*f;return ba(i);}float ah(inout vec3 v,vec3 f,vec3 y){E(v,f);float m=ax(dot(v,y)/dot(y,y));v-=y*m;E(v,-f);return m;}void bi(inout float v){v=-v;}void bj(inout vec2 v){v=-v;}void bk(inout vec3 v){v=-v;}float ai(float v,float f,float y){if(v<y&&f<y){float m=clamp(.5+.5*(f-v)/y,0.,1.),b=mix(f,v,m)-y*m*(1.-m);return b;}float m=min(v,f);return m;}float aj(float v,float f,float y){if(abs(v)<y&&abs(f)<y){float m=clamp(.5-.5*(f-v)/y,0.,1.),b=mix(f,v,m)+y*m*(1.-m);return b;}float m=max(v,f);return m;}float ak(float v,float f,float y){return aj(v,-f,y);}float al(float v,float f,float y){return ai(v,f,y);}float am(float v,float f,float y){return aj(v,f,y);}float an(float v,float f,float y){float m=min(v,f);if(v<y&&f<y){vec2 b=vec2(v,f),i=vec2(y);float x=y-distance(i,b);return min(x,m);}return m;}float ao(float v,float f,float y){float m=max(v,f);if(v>-y&&f>-y){vec2 b=vec2(v,f),i=vec2(-y);float x=distance(i,b)-y;return max(x,m);}return m;}float ap(float v,float f,float y){return ao(v,-f,y);}float aq(float v,float f,float y){float m=min(v,f),i=sqrt(.5)*(v+f-y);return min(i,m);}float ar(float v,float f,float y){float m=max(v,f),i=sqrt(.5)*(v+f+y);return max(i,m);}float as(float v,float f,float y){return ar(v,-f,y);}float at(float v,float f,float y){float m=min(v,f),i=sqrt(.5)*(v+f-y);return ai(i,m,.1*y);}float au(float v,float f,float y){float m=max(v,f),i=sqrt(.5)*(v+f+y);return aj(i,m,.1*y);}float av(float v,float f,float y){return au(v,-f,y);}float ab(float v,float f,float y,float i){float m=min(v,f);if(v<2.*y&&f<2.*y){vec2 r=vec2(v,f);float x=sqrt(.5)*y/(i+sqrt(.5)-1.);r.y-=y-x;af(r,-t/8.);K(r.x,2.*x,0.,i-1.);float b=length(r)-x;b=min(b,r.y);return min(b,m);}return m;}float ac(float v,float f,float y,float i){float m=max(v,f);if(v>-y&&f>-y){vec2 r=vec2(v,f);float x=sqrt(.5)*y/(i+sqrt(.5)-1.);r.x-=-y;r.y-=-x;af(r,-t/8.);K(r.x,2.*x,0.,i-1.);float b=length(r)-x;b=min(b,r.y);return max(b,m);}return m;}float ad(float v,float f,float y,float m){return ac(v,-f,y,m);}float ae(float v,float f,float m,float y){float b=min(v,f);vec2 i=vec2(v,f);float x=m/y*sqrt(.5);i.y-=m-sqrt(.5)*x;i.x-=sqrt(.5)*x;af(i,-t/8.);G(i.x,2.*x);i.x=abs(i.x);float r=x*sqrt(.5),e=dot(i,vec2(sqrt(.5)))-r;e=min(e,i.y);return min(e,b);}float af(float v,float f,float y,float m){return-ae(-v,-f,y,m);}float ag(float v,float f,float y,float m){return af(v,-f,y,m);}float bf(float v,float f){vec2 y=vec2(v,f);return max(ai(y),0.)-length(min(y,0.));}float bg(float v,float f){vec2 y=vec2(v,f);return min(ak(y),0.)+length(max(y,0.));}float bh(float v,float f){return bg(v,-f);}void bi(float v,MaterialId f){if(u){if(v<w)w=v,o=f;}else w=min(w,v);}void bl(MatWrap v){bj(v.f,v.m);}MatWrap bj(MatWrap v,MatWrap f){return v.f<f.f?v:f;}MatWrap bk(MatWrap v,MatWrap f){return v.f>f.f?v:f;}MatWrap bl(MatWrap v,MatWrap f){return f.f=-f.f,j(v,f);}void j(float v,MaterialId f){if(u){if(v>w)w=v,o=f;}else w=max(w,v);}MaterialId bm(float v,vec3 f){return MaterialId(v,f,vec4(0.));}Material bm(vec3 v){return Material(v,.5,0,0,vec3(0));}void ah(float v,MaterialId f,float y,float i){float m=w,x=sqrt(.5)*(m+v-y);bj(v,f);bj(x,bm(i,vec3(m,v,0.)));}void A(float v,MaterialId f,float m,float y,float i){float b=w;vec2 r=vec2(b,v);float x=m/y*sqrt(.5);r.y-=m-sqrt(.5)*x;r.x-=sqrt(.5)*x;af(r,-t/8.);G(r.x,2.*x);r.x=abs(r.x);float a=x*sqrt(.5),e=dot(r,vec2(sqrt(.5)))-a;e=min(e,r.y);bj(v,f);bj(e,bm(i,vec3(r,0.)));}void ai(MatWrap v,float f,float y,float m){B(v.f,v.m,f,y,m);}void aj(float v,MaterialId f,float y,float i){float m=w;if(m<y&&v<y){float x=clamp(.5+.5*(v-m)/y,0.,1.),b=mix(v,m,x)-y*x*(1.-x);w=b;o=bm(i,vec3(m,v,x));}bj(v,f);}MatWrap ak(MatWrap v,MatWrap f,float y,float i){MatWrap m=bj(v,f);float b=sqrt(.5)*(v.f+f.f-y);return bj(m,MatWrap(b,bm(i,vec3(v.f,f.f,0.))));}MatWrap al(MatWrap v,MatWrap f,float y,float i){float m=v.f,x=f.f;if(m<y&&x<y){float b=clamp(.5+.5*(x-m)/y,0.,1.),e=mix(x,m,b)-y*b*(1.-b);return MatWrap(e,bm(i,vec3(m,x,0.)));}MatWrap o=bj(v,f);return o;}MatWrap B(MatWrap v,MatWrap f,float m,float y,float i){float b=v.f,x=f.f;vec2 r=vec2(b,x);float a=m/y*sqrt(.5);r.y-=m-sqrt(.5)*a;r.x-=sqrt(.5)*a;af(r,-t/8.);G(r.x,2.*a);r.x=abs(r.x);float c=a*sqrt(.5),e=dot(r,vec2(sqrt(.5)))-c;e=min(e,r.y);MatWrap z=MatWrap(e,bm(i,vec3(r,0.))),M=bj(v,f);M=bj(M,z);return M;}float bn(vec3 v,float f){return length(v)-f;}float bo(vec2 v,float f){return length(v)-f;}float aw(vec3 v,float f,float y){float i=bo(v.xz,f),x=abs(v.y)-y;return bg(i,x);}float ax(vec3 v,float f,float y){float i=bo(v.xz,f),x=abs(v.y)-y;return max(i,x);}float bn(vec3 v){return min(ak(v),0.)+length(max(v,0.));}float bp(vec3 v,float f){return bn(v+f)-f;}float bo(vec3 v){return ak(v);}float bp(vec2 v){return min(ak(v),0.)+length(max(v,0.));}float bq(vec2 v,float f){return bp(v+f)-f;}float bq(vec2 v){return ak(v);}float br(vec3 v,vec3 f){vec3 y=abs(v)-f;return min(ak(y),0.)+length(max(y,0.));}float am(vec3 v,float f,float y,float m){return bs(v,vec3(f,y,m));}float bs(vec3 v,float f){return bs(v,vec3(f));}float ay(vec3 v,vec3 f,float y){return bs(v,f-y)-y;}float az(vec3 v,float f,float y){return az(v,vec3(f),y);}float bt(vec3 v,vec3 f){return ak(abs(v)-f);}float an(vec3 v,float f,float y,float m){return bu(v,vec3(f,y,m));}float bu(vec3 v,float f){return bu(v,vec3(f));}float bv(vec2 v,vec2 f){vec2 y=abs(v)-f;return min(ak(y),0.)+length(max(y,0.));}float ba(vec2 v,float f,float y){return bw(v,vec2(f,y));}float bw(vec2 v,float f){return bw(v,vec2(f));}float bb(vec2 v,vec2 f,float y){return bw(v,f-y)-y;}float bc(vec2 v,float f,float y){return bc(v,vec2(f),y);}float bx(vec2 v,vec2 f){return ak(abs(v)-f);}float bd(vec2 v,float f,float y){return by(v,vec2(f,y));}float by(vec2 v,float f){return by(v,vec2(f));}float bz(vec3 v,vec3 f){return dot(v,f);}float be(vec3 v,float f,float y){return bz(v,J(f,y));}float ca(vec2 v,vec2 f){return dot(v,f);}float cb(vec2 v,float f){return ca(v,J(f));}float cc(vec2 v,float f){return max(cb(vec2(abs(v.x),v.y),radians(30)),-v.y)-.5*f;}float bf(vec3 v,float f,float y){float i=cc(v.xz,f),x=abs(v.y)-y;return bg(i,x);}float bg(vec3 v,float f,float y){float i=cc(v.xz,f),x=abs(v.y)-y;return max(i,x);}float cd(vec2 v,float f){float y=f*sqrt(.5);vec2 i=abs(v);float m=ca(i,vec2(sqrt(.5)))-y;return m;}float ce(vec2 v,float f){float y=radians(54.),x=radians(-18.),m=f*cos(t/5./2.);vec2 i=vec2(abs(v.x),v.y);float b=cb(i,y),e=-v.y,z=cb(i,x),r=B(b,e,z)-m;return r;}float bh(vec3 v,float f,float y){float i=ce(v.xz,f),x=abs(v.y)-y;return bg(i,x);}float bi(vec3 v,float f,float y){float i=ce(v.xz,f),x=abs(v.y)-y;return max(i,x);}float cf(vec2 v,float f){float y=f*cos(t/6./2.);vec2 m=abs(v);float i=cb(m,radians(30.)),x=m.y,b=max(i,x)-y;return b;}float bj(vec3 v,float f,float y){float i=cf(v.xz,f),x=abs(v.y)-y;return bg(i,x);}float bk(vec3 v,float f,float y){float i=cf(v.xz,f),x=abs(v.y)-y;return max(i,x);}float A(vec2 v,float f,float y,float m,float x,float i,float b){float a=atan(v.y,v.x),r=length(v),c=m/4.,e=cos(c*a),s=sin(c*a),z=e/f,n=s/y,M=z<0.?-1.:1.,o=n<0.?-1.:1.,d=z*M,l=n*o,t=pow(d,i),Y=pow(l,b),X=t/d,V=Y/l,U=t+Y,T=pow(U,-1./x),R=-i*X*M/f*s,w=b*V*o/y*e,p=c/x*T/U,Z=p*p*(R*R+2.*R*w+w*w),Q=(r-T)/sqrt(1+Z);return Q;}float bl(vec3 v,float f,float y){vec2 i=vec2(bo(v.xz,f),v.y);return bo(i,y);}float cg(vec3 v,vec2 f){return cg(v,f.x,f.y);}float bm(vec3 v,float f,float y){vec2 i=vec2(by(v.xz,f),v.y);return bw(i,y);}float bn(vec3 v,float f,float y){vec2 i=vec2(bo(v.xz,f),v.y);return bw(i,y);}float ao(vec3 v,float f,float y,float m){float i=length(v.xz),x=atan(v.z,v.x);x-=clamp(x,-m,m);v.xz=i*J(x);v.x-=f;return bn(v,y);}float ch(vec3 v,vec2 f){vec2 i=vec2(length(v.xz),v.y);return ca(i,f);}float ci(vec3 v,float f){vec2 i=vec2(length(v.xz),v.y);return cb(i,f);}float ap(vec3 v,float f,float y,float m){float i=f-y,x=2*m,e=sqrt(i*i+x*x);vec2 b=vec2(x/e,i/e);vec3 r=v;E(r.y,y*b.x/b.y+m);float a=ch(r,b),z=abs(v.y)-m;return max(a,z);}float bo(vec3 v,float f,vec3 y){float i=ax(dot(v,y)/dot(y,y));return bn(v-y*i,f);}float bp(vec3 v,float f,float y){return v.x-=clamp(v.x,-y,y),bn(v,f);}float aq(vec3 v,float f,float i,vec2 y){float m=f*y.x/y.y;v.x=abs(v.x);v.x-=min(i,v.x);v.x-=m;return ch(v.yxz,y);}float ar(vec3 v,float f,float y,float i){return aq(v,f,y,J(i));}float cj(vec3 v,float f){vec3 i=abs(v);i.y-=f;float y=ca(i.xy,vec2(.816497,.57735)),x=ca(i.zy,vec2(.816497,.57735)),m=max(y,x);return m;}float bq(vec3 v,float f,float y){float i=length(v.xz),m=atan(v.z,v.x);i-=m*f/t;vec2 b=vec2(i,v.y);G(b.x,f);float x=bo(b,y);return x;}float br(vec2 v,float m,float f){vec2 e=v,y=v;e.x-=m;y.x-=-m;float r=length(e)+length(y);r=r*.5-f;return r;}float bs(vec3 v,float m,float f){vec3 e=v,y=v;e.x-=m;y.x-=-m;float r=length(e)+length(y);r=r*.5-f;return r;}float bt(vec3 v,float m,float f){vec3 e=v;e.xz=abs(e.xz);e.y-=m;float y=cb(e.xy,f),r=cb(e.zy,f),M=max(y,r);return M;}vec3 as(vec3 v,vec3 m,float f,float e){float y=ax(1-e);return normalize(mix(v,m,y*(sqrt(y)+e)));}vec3 at(vec3 v,vec3 m,vec3 f,float e){float y=ax(dot(v,m));vec3 r=2.*dot(v,m)*v-m,M=as(v,r,y,sqrt(e)),x=textureLod(W,M,sqrt(e)*5.).xyz;vec2 i=textureLod(h,vec2(e,y),0.).xy;return x*(f*i.x+i.y);}vec3 bu(vec3 v,vec3 m,Material f){vec3 e=textureLod(q,v,0.).xyz,y=f.color*e+at(v,m,vec3(.04),f.roughness),r=at(v,m,f.color,f.roughness);return mix(y,r,f.metallic);}vec3 bv(vec3 v,vec3 m,float f){v.xz-=z.xz;float e=ar(dot(m,v))-dot(v,v)+f*f,y=-dot(m,v)+sqrt(e);return textureLod(k,normalize(v+y*m),0.).xyz;}vec3 A(vec3 v,float m,vec3 f,vec3 e,vec3 y,Material r){return r.color=.5*y+.5,bu(y,-f,r);}float bw(vec3 v,vec3 m,SphereLight f){vec3 e=f.position-v;float y=dot(e,e);vec3 r=e*inversesqrt(y);float M=acos(dot(m,r)),x=sqrt(y),i=x/f.radius,l=sqrt(ar(i)-1),z=-l/tan(M),s=0;if(i*cos(M)>1)s=cos(M)/ar(i);else s=1./(d*ar(i))*(cos(M)*acos(z)-l*sin(M)*sqrt(1-z*z))+1/d*atan(sin(M)*sqrt(1-ar(z))/l);s*=d;return s;}vec3 E(vec3 v,vec3 m,vec3 f,float e,SphereLight y){vec3 r=reflect(-f,m),M=as(m,r,H(m,f),e),x=y.position-v,i=dot(x,M)*M-x,l=x+i*ax(y.radius/length(i));return l;}float ck(float v,float m){float f=ar(m),e=(1-f)/f*v;return sqrt(1+e);}float au(vec3 v,vec3 m,vec3 f,float e){vec3 y=normalize(v+m);float r=H(f,m),M=H(f,v),x=H(f,y),i=ar(e),l=ar(i),z=max(d*ar(ar(x)*(l-1)+1),1e-08);z*=ck(l,M)+ck(l,r);z*=2*r*M;return max(l/z,0);}vec3 bx(vec3 v,vec3 m,vec3 f){vec3 e=normalize(v+m);float y=H(v,e);return f+(1-f)*exp2((-5.55473*y-6.98316)*y);}vec3 B(vec3 v,float m,vec3 f,vec3 e,vec3 y,Material r,SphereLight M){vec3 x=M.position-e;float i=dot(x,x);x/=sqrt(i);float l=H(x,y),z=M.power/(4*ar(d)*ar(M.radius));z*=bw(e,y,M);vec3 s=r.color*(max(0,l*z)/d),a=E(e,y,-f,r.roughness,M);float c=ax(r.roughness+M.radius/(2*sqrt(i))),n=dot(a,a);a/=sqrt(n);float t=ar(r.roughness/c),g=M.power*t/(4*d*n);vec3 S=bx(-f,a,r.color);float p=g*l*au(-f,a,y,r.roughness);vec3 b=bx(-f,a,vec3(.04));return mix(s+b*p,p*S,r.metallic);}float br(vec3 v){return abs(bz(v,normalize(F))-C);}void B(){int v=int(L);if(v==0)Z=true,Y=false,X=false,V=false,U=false,T=false,R=false;else if(v==1)Z=true,Y=true,X=true,V=false,U=false,T=false,R=false;else if(v==2)Z=false,Y=true,X=true,V=false,U=false,T=false,R=false;else if(v==3)Z=true,Y=false,X=false,V=false,U=true,T=true,R=false;else if(v==4)Z=true,Y=true,X=true,V=false,U=true,T=true,R=false;else if(v==5)Z=false,Y=true,X=true,V=false,U=true,T=true,R=false;else Z=true,Y=false,X=false,V=false,U=false,T=false,R=false;Q=Z;P=Y;}vec3 by(float v,vec3 m,float f){float e=abs(sin(d*10.*v));e=1.-(1.-smoothstep(8.,15.,f))*(1.-e);float y=abs(sin(d*v));y=1.-(.8+.2*smoothstep(6.,10.,f))*(1.-smoothstep(60.,80.,f))*(1.-y);float r=abs(sin(d/10.*v));r=1.-(.8+.2*smoothstep(30.,50.,f))*(1.-smoothstep(80.,150.,f))*(1.-r);float M=br(m);vec3 x=vec3(0.),i=vec3(.29804,.18824,.43922),l=vec3(.12549,.52941,.36078),z=vec3(.02095,.19046,.60548),s=mix(i,l,smoothstep(.1*M,M,v));if(v<0.)s=z;s=bd(s);s.y*=1.-smoothstep(M,10.*M,abs(v));s=be(s);s=mix(x,s,e);s=mix(x,s,y);s=mix(x,s,r);return s;}void bz(vec3 v,inout vec3 m,float f){vec3 e=dFdx(v),y=dFdy(v),r=cross(y,m),M=cross(m,e);float x=dot(e,r),i=dFdx(f),l=dFdy(f);vec3 z=(i*r+l*M)*sign(x),s=normalize(abs(x)*m-z);m=s;}float av(vec3 v,float m,float f,float e){float y=atan(v.x,v.z);vec2 r=vec2(bo(v.xz,m),v.y);e*=ba(v.z);float M=1.;if(length(r)<f+.05*sqrt(2))af(r,2*(y+e)),M*=sqrt(4+ar(d/(t*2)));float x=f/8*2;ae(r,8,f);if(length(r)<x*sqrt(2))af(r,-5*(y+e)),M*=sqrt(4+ar(d/(t*5)));float i=cf(r,x)/M;return i;}float aw(vec3 v,float m,float f,float e){float y=atan(v.x,v.z);vec2 r=vec2(cf(v.xz,m),v.y);float M=cf(r,f);af(r,radians(30));ae(r,6,f);float x=f/6*.5;M=ag(M,bw(r,x*vec2(3,1)),x*3,4);return M;}float ca(vec3 v,vec2 m,vec3 f){float e=ax(dot(v,f)/dot(f,f));return aw(v-f*e,m.x,m.y,e*length(f));}float bs(vec3 v){vec3 m=v;float f=ca(m,vec2(1,.2),vec3(3,0,0));bj(f,MaterialId(0,v));return f;}float cl(vec3 v,bool m){w=p;u=m;if(P)bj(br(v),bm(D,v));if(Q)bs(v);return w;}vec3 cm(vec3 v,float m){vec3 f[6]=vec3[6](vec3(m,0,0),vec3(0,m,0),vec3(0,0,m),vec3(-m,0,0),vec3(0,-m,0),vec3(0,0,-m));float e[6]=float[6](0,0,0,0,0,0);for(int y=0;y<6;y++)e[y]=cl(v+f[y],false);return vec3(e[0]-e[3],e[1]-e[4],e[2]-e[5]);}vec3 cn(vec3 v,float m){return normalize(cm(v,m));}vec3 bt(vec3 v){float m=max(5e-05,ag(distance(v,z)));m*=I;return bt(v,m);}vec3 co(vec3 v,vec3 m){vec3 f=bt(v);if(dot(m,f)>0.){f=normalize(dFdx(f)+f);if(dot(m,f)>0.)f=normalize(dFdy(f)+f);}return f;}vec3 cp(vec3 v,float m){return cm(v,m)/(2.*m);}vec3 bu(vec3 v){float m=max(5e-05,ag(distance(v,z)));m*=I;return bu(v,m);}float A(vec3 v,vec3 m,float f,float e,float y,int r,float M,bool x){float i=f,l=b,z=f,s=0,a=0,c=ba(cl(v,false));for(int n=0;n<r;++n){float d=c*cl(m*i+v,false),t=abs(d);bool g=M>1&&t+s<a;if(g)a-=M*a,M=1;else a=d*M;s=t;float S=t/i;if(!g&&S<l)z=i,l=S;if(!g&&S<y||i>e){break;}i+=a;}if((i>e||l>y)&&!x)return b;return z;}float cb(vec3 v,vec3 m,float f){float e=A(v,m,.001,f,ag(1),256,1.2,false);if(isinf(e))return e;for(int y=0;y<3;y++)e+=cl(v+e*m,false)-ag(e);return e;}vec3 cc(vec3 v,vec3 m,float f){Q=X;P=V;float e=cl(v,false);vec3 y=bt(v);Q=Z;P=Y;vec3 r=dFdx(v),M=dFdy(v);int x=5,i=5;vec3 l=vec3(0);for(int z=0;z<i;z++){for(int s=0;s<x;s++){vec2 a=(vec2(s,z)+.5)/vec2(x,i)-.5;vec3 c=a.x*r+a.y*M;float n=e+dot(y,c);l+=by(n,m,f);}}return l/float(x*i);}vec3 cd(vec3 v,float m,vec3 f){return cc(f,v,m);}vec3 bv(vec3 v){Q=T;P=R;vec3 m=bu(v);float f=length(m);Q=Z;P=Y;vec3 e=vec3(.18014,.74453,.03288),y=vec3(.71547,.03995,.02537),r=vec3(1.);r=mix(r,e,1.-smoothstep(.8,1.,f));r=mix(r,y,smoothstep(1.,1.2,f));return r;}float cq(vec3 v,vec3 m){return ax(dot(v,m));}float ce(float v,float m,float f){return v+(m-v)*pow(1.-f,5.);}vec3 cf(vec3 v,vec3 m,float f){return v+(m-v)*pow(1.-f,5.);}float ax(float v,float m,float f,float e){float y=mix(0.,.5,e),r=mix(1.,1./1.51,e),M=y+2.*f*f*e,x=cf(1,M,m),i=cf(1,M,v);return x*i*r/d;}float cr(float v,float m){float f=(1-ar(m))/ar(m);return(-1+sqrt(1+ar(v)*f))*.5;}vec3 E(vec3 m,float f,vec3 e,vec3 y,vec3 r,MaterialId M,Material x){return A(m,f,e,y,r,x);vec3 i=r*.5+.5,l=vec3(0,0,5),z=y,s=-e,a=normalize(l-z),c=normalize(a+s);float n=max(cq(r,s),1e-06),t=max(cq(r,a),1e-06),g=max(cq(r,c),1e-06),S=max(cq(s,c),1e-06),p=ax(x.roughness);p*=p;vec2 b=vec2(p,t),u=textureLod(h,b,0.).xy;float w=1./d;w*=1.-u.x*.04-u.y;w*=.5;float o=cf(.04,1.,S);o/=d*ar(p)*ar(ar(g))*ar(1+(1-ar(g))/ar(g*p));o/=1+cr(p,n)*cr(p,t);o/=4*t*n;float k=1000./(4.*d*dot(l-z,l-z));return w*cq(normalize(l-z),r)*k*v;}vec3 ay(vec3 v,float m,vec3 f,vec3 e){return e;}Material bw(MaterialId v){Material m=bm(vec3(1));m.roughness=(ab(v.coord*3)*.5+.5)*.3+.5;return m;}void main(){B();vec3 v=z,m=A();float f=cb(v,m,O);if(isinf(f))r=bv(v,m,O),M=O;else{vec3 e=v+f*m;float x=cl(e,true);MaterialId i=o;vec3 l=co(e,m);if(i.id==D){vec3 s=cd(v,f,e);if(U){vec3 a=bv(e);s=mix(s,a,.5);}Material a=bm(s);a.roughness=1.;r=bu(l,-m,a);}else{if(U){vec3 s=bv(e);Material a=bm(s);a.roughness=0.;r=bu(l,-m,a);}else{Material s=bw(i);s.roughness=ar(s.roughness);r=E(v,f,m,e,l,i,s);}}M=f;}r=ay(v,f,m,r);r*=exp2(y);};
#endif
