#ifndef tonemap_H
#define tonemap_H
const char tonemap_source[] = R"shader_source(#version 430
layout(location=0)uniform vec2 y;layout(location=0)in vec2 v;
#line 1
layout(location=2)uniform vec3 m;layout(location=3)uniform vec4 f;layout(location=4)uniform float s;
#ifndef FOCAL_LENGTH
layout(location=5)uniform float z;
#endif
float n=6.28319;struct Material{vec3 color;float roughness;float metallic;};struct SphereLight{vec3 center;vec3 color;float radius;float intensity;};
#line 4
layout(binding=1)uniform sampler2D luminance;layout(binding=11)uniform sampler2D x;layout(binding=10)uniform sampler2D l;layout(binding=9)uniform sampler2D w;layout(binding=8)uniform sampler2D c;layout(binding=0)uniform sampler2D d;layout(location=11)uniform float r;layout(location=12)uniform float i;layout(location=13)uniform float a;layout(location=14)uniform vec3 e;layout(location=15)uniform vec3 S;layout(location=16)uniform vec3 t;layout(location=0)out vec3 g;float b=.15,o=.5,M=.1,u=.2,p=.02,k=.3,h=11.2;vec3 F(vec3 v,vec4 y){vec3 f=2*cross(y.xyz,v);return v+y.w*f+cross(y.xyz,f);}vec3 F(){vec3 v=normalize(vec3((gl_FragCoord.xy-.5*y)/y.x,-z/.03));return F(v,f);}vec3 F(vec3 v,vec3 x,out int f,int y,float z){float r=0.;for(f=0;f<y;f++){float l=f(v)[0]*z;v+=x*l;l=abs(l);r+=l;if(l<.001*r)break;}return v;}vec3 F(vec3 v,vec3 f,out int y){return F(v,f,y,100,1.);}vec3 F(vec3 v){vec2 f=vec2(.001,0.);return normalize(vec3(f(v+f.xyy)[0]-f(v-f.xyy)[0],f(v+f.yxy)[0]-f(v-f.yxy)[0],f(v+f.yyx)[0]-f(v-f.yyx)[0])+1e-09);}float L(vec3 v,float y){return length(v)-y;}float F(vec3 v,vec3 y,vec3 f,float z){vec3 x=v-y,l=f-y;float m=clamp(dot(x,l)/dot(l,l),0.,1.);return length(x-l*m)-z;}float D(vec3 v,vec2 y){vec2 f=vec2(length(v.xz)-y.x,v.y);return length(f)-y.y;}float C(vec3 v,vec3 y){return v=abs(v)-y,max(v.x,max(v.y,v.z));}float T(vec2 v,vec2 y){return v=abs(v)-y,max(v.x,v.y);}float O(vec3 v,vec3 y){vec3 f=abs(v)-y;return min(max(f.x,max(f.y,f.z)),0.)+length(max(f,0.));}float C(vec3 v,vec3 f,float y){return O(v,f-y)-y;}float N(vec3 v,vec2 y){float f=length(v.xy);return dot(y,vec2(f,v.z));}float H(vec3 v,vec3 y){return dot(v,y.xyz);}vec2 G(vec2 v,vec2 y){return mix(v,y,float(v.x>y.x));}float D(float v,float f,float y){float m=clamp(.5+.5*(f-v)/y,0.,1.);return mix(f,v,m)-y*m*(1.-m);}vec2 G(vec2 v,vec2 f,float y){return vec2(D(v,f,y),v.x>f.x?f.y:v.y);}vec2 H(vec2 v,vec2 f,float y){float m=clamp(.5+.5*(f-v)/y,0.,1.);return vec2(mix(f.x,v.x,m)-y*m*(1.-m),mix(f.y,v.y,m));}float L(float v,float f,float y){float m=clamp(.5-.5*(f-v)/y,0.,1.);return mix(f,v,m)+y*m*(1.-m);}float E(vec3 v,vec3 y){return max(0.,dot(v,y));}float C(float y){return y*y;}vec3 C(vec3 v,vec3 y,vec3 f,Material m,SphereLight d){vec3 x=d.center-v,z=reflect(-f,y),l=dot(x,z)*z-x,n=x+l*clamp(d.radius/length(l),0.,1.),s=normalize(n);float w=distance(v,d.center),c=acos(-1.);vec3 r=.5*(s+f);float b=dot(y,r),g=E(y,s),Q=dot(y,f),o=C(m.roughness),K=C(o),i=C(m.roughness+1.),a=K/(4.*mix(g,1.,i)*mix(Q,1.,i)*c*C(C(b)*(K-1.)+1.)),p=clamp(o+d.radius*.5/w,0.,1.),k=K/(p*p),M=dot(f,r),e=exp2((-5.55473*M-6.98316)*M),h=.04+.96*e;vec3 S=m.color+(1.-m.color)*e,u=.5*(m.color/c+a*h),t=a*S;float F=C(1.-C(C(w/d.radius))),L=clamp(F,0.,1.)/(C(w)+1.);return g*mix(u,t,m.metallic)*L*d.intensity*d.color*k;}vec3 A(vec3 v,float y){return v*y;}vec3 Z(vec3 v,vec3 y){return mod(v,y)-.5*y;}vec3 A(vec3 v,float f,float y,float m){return Z(v,vec3(f,y,m));}vec3 Y(vec3 v,vec3 y){return v-y;}vec3 C(vec3 v,float f,float y,float m){return Y(v,vec3(f,y,m));}mat3 A(float v){return mat3(1.,0.,0.,0.,cos(v),sin(v),0.,-sin(v),cos(v));}mat3 D(float v){return mat3(cos(v),0.,-sin(v),0.,1.,0.,sin(v),0.,cos(v));}mat3 E(float v){return mat3(cos(v),sin(v),0.,-sin(v),cos(v),0.,0.,0.,1.);}mat2 G(float v){return mat2(cos(v),-sin(v),sin(v),cos(v));}float X(float v,float y){const float f=v*y;return f*exp(1.-f);}float A(float y,float v,float f){return clamp((f-y)/(v-y),0.,1.);}float H(float v){return v-floor(v*(1./289.))*289.;}vec2 L(vec2 v){return v-floor(v*(1./289.))*289.;}vec3 N(vec3 v){return v-floor(v*(1./289.))*289.;}vec4 O(vec4 v){return v-floor(v*(1./289.))*289.;}float T(float v){return O((v*34.+1.)*v);}vec2 X(vec2 v){return O((v*34.+1.)*v);}vec3 Y(vec3 v){return O((v*34.+1.)*v);}vec4 Z(vec4 v){return O((v*34.+1.)*v);}vec4 W(vec4 v){return 1.79284-.853735*v;}vec2 V(vec2 v){return v*v*v*(v*(v*6.-15.)+10.);}vec3 U(vec3 v){return v*v*v*(v*(v*6.-15.)+10.);}float R(vec2 v){vec4 f=floor(v.xyxy)+vec4(0.,0.,1.,1.),m=fract(v.xyxy)-vec4(0.,0.,1.,1.);f=O(f);vec4 y=f.xzxz,x=f.yyww,l=m.xzxz,d=m.yyww,n=Z(Z(y)+x),r=fract(n*(1./41.))*2.-1.,g=abs(r)-.5,s=floor(r+.5);r=r-s;vec2 z=vec2(r.x,g.x),w=vec2(r.y,g.y),c=vec2(r.z,g.z),b=vec2(r.w,g.w);vec4 K=W(vec4(dot(z,z),dot(c,c),dot(w,w),dot(b,b)));z*=K.x;c*=K.y;w*=K.z;b*=K.w;float F=dot(z,vec2(l.x,d.x)),Q=dot(w,vec2(l.y,d.y)),i=dot(c,vec2(l.z,d.z)),o=dot(b,vec2(l.w,d.w));vec2 a=U(m.xy),M=mix(vec2(F,i),vec2(Q,o),a.x);float e=mix(M.x,M.y,a.y);return 2.3*e;}float Q(vec3 v){vec3 f=floor(v),y=f+vec3(1.);f=O(f);y=O(y);vec3 m=fract(v),l=m-vec3(1.);vec4 x=vec4(f.x,y.x,f.x,y.x),z=vec4(f.yy,y.yy),n=f.zzzz,d=y.zzzz,s=Z(Z(x)+z),K=Z(s+n),c=Z(s+d),r=K*(1./7.),g=fract(floor(r)*(1./7.))-.5;r=fract(r);vec4 w=vec4(.5)-abs(r)-abs(g),a=step(w,vec4(0.));r-=a*(step(0.,r)-.5);g-=a*(step(0.,g)-.5);vec4 b=c*(1./7.),o=fract(floor(b)*(1./7.))-.5;b=fract(b);vec4 Q=vec4(.5)-abs(b)-abs(o),t=step(Q,vec4(0.));b-=t*(step(0.,b)-.5);o-=t*(step(0.,o)-.5);vec3 i=vec3(r.x,g.x,w.x),M=vec3(r.y,g.y,w.y),u=vec3(r.z,g.z,w.z),p=vec3(r.w,g.w,w.w),h=vec3(b.x,o.x,Q.x),e=vec3(b.y,o.y,Q.y),F=vec3(b.z,o.z,Q.z),k=vec3(b.w,o.w,Q.w);vec4 S=W(vec4(dot(i,i),dot(u,u),dot(M,M),dot(p,p)));i*=S.x;u*=S.y;M*=S.z;p*=S.w;vec4 L=W(vec4(dot(h,h),dot(F,F),dot(e,e),dot(k,k)));h*=L.x;F*=L.y;e*=L.z;k*=L.w;float I=dot(i,m),D=dot(M,vec3(l.x,m.yz)),C=dot(u,vec3(m.x,l.y,m.z)),T=dot(p,vec3(l.xy,m.z)),N=dot(h,vec3(m.xy,l.z)),H=dot(e,vec3(l.x,m.y,l.z)),G=dot(F,vec3(m.x,l.yz)),E=dot(k,l);vec3 Y=U(m);vec4 A=mix(vec4(I,D,C,T),vec4(N,H,G,E),Y.z);vec2 X=mix(A.xy,A.zw,Y.y);float V=mix(X.x,X.y,Y.x);return 2.2*V;}float P(vec2 v){vec2 y=O(v),f=Z(y);return fract(Z(f.x*f.y+y.x+y.y)/41.)*2.-1.;}float K(vec3 v){vec3 y=O(v),f=Z(y);return fract(Z(f.x*f.y*f.z+y.x+y.y+y.z)/41.)*2.-1.;}float J(vec2 v){vec2 f=floor(v),y=fract(v),m=vec2(1.,0.);float x=K(f+m.yy),l=K(f+m.yx),w=K(f+m.xy),g=K(f+m.xx);y=U(y);return mix(mix(x,w,y.x),mix(l,g,y.x),y.y);}float I(vec3 v){vec3 f=floor(v),y=fract(v);vec2 m=vec2(1.,0.);float x=K(f+m.yyy),l=K(f+m.yyx),w=K(f+m.yxy),g=K(f+m.yxx),z=K(f+m.xyy),n=K(f+m.xyx),d=K(f+m.xxy),o=K(f+m.xxx);y=U(y);return mix(mix(mix(x,z,y.x),mix(w,d,y.x),y.y),mix(mix(l,n,y.x),mix(g,o,y.x),y.y),y.z);}float B(vec2 v){return(Q(v)+Q(v*2.)*.5+Q(v*4.)*.25)/1.75;}float q(vec3 v){return(Q(v)+Q(v*2.)*.5+Q(v*4.)*.25)/1.75;}float j(vec2 v){return(I(v)+I(v*2.)*.5+I(v*4.)*.25)/1.75;}float ab(vec3 v){return(I(v)+I(v*2.)*.5+I(v*4.)*.25)/1.75;}vec3 ac(vec3 v){return(v*(b*v+M*o)+u*p)/(v*(b*v+o)+u*k)-p/k;}void main(){vec4 f=textureLod(c,v,0.);vec3 y=textureLod(d,v,0.).xyz;y=mix(y,f.xyz,smoothstep(0.,1.,abs(f.w)-.5));vec3 m=vec3(0.);m+=textureLod(x,v,0.).xyz;m+=textureLod(l,v,0.).xyz;m+=textureLod(w,v,0.).xyz;m/=3.;vec2 b=v*800.;vec3 z=.1*vec3(smoothstep(-.3,.7,Q(b*.008)));z+=.9*step(.7,vec3(Q(b)))*smoothstep(0.,.7,Q(b*.02));y=mix(y,mix(m,m*z,r),i);float n=exp(textureLod(luminance,v,0.).x);y*=a/n;y=ac(y)/ac(vec3(h));y=clamp(y,0.,1.);y=t*(y+e*pow(1.-y,1./S));g=y;})shader_source";
#endif
