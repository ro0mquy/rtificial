#ifndef raymarching_H
#define raymarching_H
const char raymarching_source[] = R"shader_source(#version 430
layout(location=0)uniform vec2 y;layout(location=0)out vec3 v;layout(location=1)out float r;layout(location=16)uniform float m;layout(location=6)uniform float f;
#define FOCAL_LENGTH
layout(location=2)uniform float d;
#line 1
layout(location=3)uniform vec3 x;layout(location=4)uniform vec4 z;layout(location=5)uniform float c;
#ifndef FOCAL_LENGTH
layout(location=6)uniform float w;
#endif
float n=6.28319;struct Material{vec3 color;float roughness;float metallic;};struct SphereLight{vec3 center;vec3 color;float radius;float intensity;};layout(location=23)uniform vec3 l;layout(location=24)uniform vec3 i;layout(location=25)uniform vec3 s;vec3 F[4]=vec3[4](l,i,vec3(.03,0.,0.),vec3(0.));void t(vec3 x,float f){float z=z,m=w,l=d;r=(f-z)/f*(m*m)/(l*(z-m))/.03*y.x;v=x;}vec3 p(vec3 x,vec4 v){vec3 y=2*cross(v.xyz,x);return x+v.w*y+cross(v.xyz,y);}vec3 p(){vec3 v=normalize(vec3((gl_FragCoord.xy-.5*y)/y.x,-w/.03));return p(v,z);}float h(vec3 v,float y){return length(v)-y;}float h(vec3 v,vec3 x,vec3 f,float y){vec3 m=v-x,z=f-x;float n=clamp(dot(m,z)/dot(z,z),0.,1.);return length(m-z*n)-y;}float e(vec3 v,vec2 y){vec2 m=vec2(length(v.xz)-y.x,v.y);return length(m)-y.y;}float M(vec3 v,vec3 y){return v=abs(v)-y,max(v.x,max(v.y,v.z));}float S(vec2 v,vec2 y){return v=abs(v)-y,max(v.x,v.y);}float o(vec3 v,vec3 y){vec3 f=abs(v)-y;return min(max(f.x,max(f.y,f.z)),0.)+length(max(f,0.));}float M(vec3 v,vec3 f,float y){return o(v,f-y)-y;}float a(vec3 v,vec2 y){float f=length(v.xy);return dot(y,vec2(f,v.z));}float u(vec3 v,vec3 y){return dot(v,y.xyz);}vec2 g(vec2 v,vec2 y){return mix(v,y,float(v.x>y.x));}float S(float v,float f,float y){float m=clamp(.5+.5*(f-v)/y,0.,1.);return mix(f,v,m)-y*m*(1.-m);}vec2 a(vec2 v,vec2 f,float y){return vec2(S(v,f,y),v.x>f.x?f.y:v.y);}vec2 e(vec2 v,vec2 f,float y){float m=clamp(.5+.5*(f-v)/y,0.,1.);return vec2(mix(f.x,v.x,m)-y*m*(1.-m),mix(f.y,v.y,m));}float g(float v,float f,float y){float m=clamp(.5-.5*(f-v)/y,0.,1.);return mix(f,v,m)+y*m*(1.-m);}float b(vec3 v,vec3 y){return max(0.,dot(v,y));}float M(float y){return y*y;}vec3 M(vec3 v,vec3 y,vec3 f,Material m,SphereLight d){vec3 x=d.center-v,z=reflect(-f,y),l=dot(x,z)*z-x,n=x+l*clamp(d.radius/length(l),0.,1.),s=normalize(n);float w=distance(v,d.center),c=acos(-1.);vec3 i=.5*(s+f);float r=dot(y,i),F=b(y,s),U=dot(y,f),g=M(m.roughness),A=M(g),S=M(m.roughness+1.),a=A/(4.*mix(F,1.,S)*mix(U,1.,S)*c*M(M(r)*(A-1.)+1.)),h=clamp(g+d.radius*.5/w,0.,1.),o=A/(h*h),e=dot(f,i),k=exp2((-5.55473*e-6.98316)*e),t=.04+.96*k;vec3 p=m.color+(1.-m.color)*k,G=.5*(m.color/c+a*t),u=a*p;float T=M(1.-M(M(w/d.radius))),L=clamp(T,0.,1.)/(M(w)+1.);return F*mix(G,u,m.metallic)*L*d.intensity*d.color*o;}vec3 L(vec3 v,float y){return v*y;}vec3 C(vec3 v,vec3 y){return mod(v,y)-.5*y;}vec3 C(vec3 v,float f,float y,float m){return C(v,vec3(f,y,m));}vec3 T(vec3 v,vec3 y){return v-y;}vec3 L(vec3 v,float f,float y,float m){return T(v,vec3(f,y,m));}mat3 C(float v){return mat3(1.,0.,0.,0.,cos(v),sin(v),0.,-sin(v),cos(v));}mat3 L(float v){return mat3(cos(v),0.,-sin(v),0.,1.,0.,sin(v),0.,cos(v));}mat3 S(float v){return mat3(cos(v),sin(v),0.,-sin(v),cos(v),0.,0.,0.,1.);}mat2 T(float v){return mat2(cos(v),-sin(v),sin(v),cos(v));}float O(float v,float y){const float m=v*y;return m*exp(1.-m);}float C(float y,float v,float f){return clamp((f-y)/(v-y),0.,1.);}float O(float v){return v-floor(v*(1./289.))*289.;}vec2 a(vec2 v){return v-floor(v*(1./289.))*289.;}vec3 b(vec3 v){return v-floor(v*(1./289.))*289.;}vec4 e(vec4 v){return v-floor(v*(1./289.))*289.;}float g(float v){return e((v*34.+1.)*v);}vec2 h(vec2 v){return e((v*34.+1.)*v);}vec3 o(vec3 v){return e((v*34.+1.)*v);}vec4 p(vec4 v){return e((v*34.+1.)*v);}vec4 t(vec4 y){return 1.79284-.853735*y;}vec2 u(vec2 v){return v*v*v*(v*(v*6.-15.)+10.);}vec3 N(vec3 v){return v*v*v*(v*(v*6.-15.)+10.);}float H(vec2 v){vec4 y=floor(v.xyxy)+vec4(0.,0.,1.,1.),f=fract(v.xyxy)-vec4(0.,0.,1.,1.);y=e(y);vec4 m=y.xzxz,z=y.yyww,d=f.xzxz,n=f.yyww,l=p(p(m)+z),x=fract(l*(1./41.))*2.-1.,c=abs(x)-.5,s=floor(x+.5);x=x-s;vec2 r=vec2(x.x,c.x),w=vec2(x.y,c.y),i=vec2(x.z,c.z),F=vec2(x.w,c.w);vec4 A=t(vec4(dot(r,r),dot(i,i),dot(w,w),dot(F,F)));r*=A.x;i*=A.y;w*=A.z;F*=A.w;float g=dot(r,vec2(d.x,n.x)),U=dot(w,vec2(d.y,n.y)),S=dot(i,vec2(d.z,n.z)),o=dot(F,vec2(d.w,n.w));vec2 u=N(f.xy),h=mix(vec2(g,S),vec2(U,o),u.x);float k=mix(h.x,h.y,u.y);return 2.3*k;}float G(vec3 v){vec3 f=floor(v),y=f+vec3(1.);f=e(f);y=e(y);vec3 m=fract(v),x=m-vec3(1.);vec4 z=vec4(f.x,y.x,f.x,y.x),n=vec4(f.yy,y.yy),d=f.zzzz,c=y.zzzz,l=p(p(z)+n),A=p(l+d),s=p(l+c),r=A*(1./7.),i=fract(floor(r)*(1./7.))-.5;r=fract(r);vec4 w=vec4(.5)-abs(r)-abs(i),a=step(w,vec4(0.));r-=a*(step(0.,r)-.5);i-=a*(step(0.,i)-.5);vec4 F=s*(1./7.),h=fract(floor(F)*(1./7.))-.5;F=fract(F);vec4 g=vec4(.5)-abs(F)-abs(h),S=step(g,vec4(0.));F-=S*(step(0.,F)-.5);h-=S*(step(0.,h)-.5);vec3 U=vec3(r.x,i.x,w.x),o=vec3(r.y,i.y,w.y),u=vec3(r.z,i.z,w.z),G=vec3(r.w,i.w,w.w),T=vec3(F.x,h.x,g.x),k=vec3(F.y,h.y,g.y),L=vec3(F.z,h.z,g.z),M=vec3(F.w,h.w,g.w);vec4 b=t(vec4(dot(U,U),dot(u,u),dot(o,o),dot(G,G)));U*=b.x;u*=b.y;o*=b.z;G*=b.w;vec4 C=t(vec4(dot(T,T),dot(L,L),dot(k,k),dot(M,M)));T*=C.x;L*=C.y;k*=C.z;M*=C.w;float Z=dot(U,m),O=dot(o,vec3(x.x,m.yz)),H=dot(u,vec3(m.x,x.y,m.z)),E=dot(G,vec3(x.xy,m.z)),Y=dot(T,vec3(m.xy,x.z)),X=dot(k,vec3(x.x,m.y,x.z)),W=dot(L,vec3(m.x,x.yz)),V=dot(M,x);vec3 R=N(m);vec4 Q=mix(vec4(Z,O,H,E),vec4(Y,X,W,V),R.z);vec2 P=mix(Q.xy,Q.zw,R.y);float K=mix(P.x,P.y,R.x);return 2.2*K;}float E(vec2 v){vec2 y=e(v),f=p(y);return fract(p(f.x*f.y+y.x+y.y)/41.)*2.-1.;}float A(vec3 v){vec3 y=e(v),f=p(y);return fract(p(f.x*f.y*f.z+y.x+y.y+y.z)/41.)*2.-1.;}float k(vec2 v){vec2 f=floor(v),y=fract(v),m=vec2(1.,0.);float x=A(f+m.yy),z=A(f+m.yx),n=A(f+m.xy),w=A(f+m.xx);y=N(y);return mix(mix(x,n,y.x),mix(z,w,y.x),y.y);}float Z(vec3 v){vec3 f=floor(v),y=fract(v);vec2 m=vec2(1.,0.);float x=A(f+m.yyy),z=A(f+m.yyx),w=A(f+m.yxy),n=A(f+m.yxx),i=A(f+m.xyy),d=A(f+m.xyx),c=A(f+m.xxy),h=A(f+m.xxx);y=N(y);return mix(mix(mix(x,i,y.x),mix(w,c,y.x),y.y),mix(mix(z,d,y.x),mix(n,h,y.x),y.y),y.z);}float Y(vec2 v){return(G(v)+G(v*2.)*.5+G(v*4.)*.25)/1.75;}float X(vec3 v){return(G(v)+G(v*2.)*.5+G(v*4.)*.25)/1.75;}float W(vec2 v){return(Z(v)+Z(v*2.)*.5+Z(v*4.)*.25)/1.75;}float V(vec3 v){return(Z(v)+Z(v*2.)*.5+Z(v*4.)*.25)/1.75;}vec2 U(vec3 v){v.z+=3.;v.x-=1.;vec2 f=vec2(h(v,.7),0.);v.x+=2.;vec2 y=vec2(h(T(v,10*s),.7),1.),m=vec2(v.y+2.,2.),z=vec2(-h(v-x,50.),3.);return g(g(f,y),g(m,z));}vec3 A(vec3 v,vec3 y,out int f,int x,float m){float r=0.;for(f=0;f<x;f++){float z=U(v)[0]*m;v+=y*z;z=abs(z);r+=z;if(z<.001*r)break;}return v;}vec3 A(vec3 v,vec3 y,out int f){return A(v,y,f,100,1.);}vec3 R(vec3 v){vec2 y=vec2(.001,0.);return normalize(vec3(U(v+y.xyy)[0]-U(v-y.xyy)[0],U(v+y.yxy)[0]-U(v-y.yxy)[0],U(v+y.yyx)[0]-U(v-y.yyx)[0])+1e-09);}float A(vec3 v,vec3 y,float f,float m){float x,z=sign(f);for(x=z*.5+.5;m>0;m--)x-=(m*f-U(v+y*m*f*z)[0])/exp2(m);return x;}void main(){vec3 v=p();int y;vec3 f=A(x,v,y),m=vec3(0.);if(y<150){int l=int(U(f).y);vec3 z=R(f);Material r;if(l==0.||l==1.)r=Material(F[l],.2,1.);else if(l==2.){float n=2.,w=mod(floor(f.x/n),2.);r=Material(F[l]*w,.5,0.);}else if(l==3.)r=Material(F[l],1.,0.);m=M(f,z,-v,r,SphereLight(vec3(5.,9.,10.),vec3(1.),2.,100.));}t(m,distance(f,x));})shader_source";
#endif
