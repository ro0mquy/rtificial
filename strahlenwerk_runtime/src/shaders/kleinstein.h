#ifndef kleinstein_H
#define kleinstein_H
const char kleinstein_source[] =#version 430
layout((location=169))uniform float f;layout((location=170))uniform float v;layout((location=171))uniform float y;layout((location=172))uniform float x;layout((location=173))uniform float m;layout((location=174))uniform float a;layout((location=175))uniform vec3 z;layout((location=176))uniform float M;layout((location=177))uniform float s;layout((location=178))uniform float i;layout((location=179))uniform vec2 e;layout((location=180))uniform float c;layout((location=181))uniform float n;layout((location=182))uniform vec2 t;layout((location=183))uniform float l;layout((location=184))uniform float d;layout((location=185))uniform float p;layout((location=186))uniform float r;layout((location=187))uniform float S;layout((location=188))uniform float h;layout((location=189))uniform float w;layout((location=190))uniform vec3 b;layout((location=191))uniform float o;layout((location=192))uniform float k;layout((location=193))uniform vec2 u;layout((location=194))uniform float g;layout((location=195))uniform float W;layout((location=196))uniform float q;layout((location=197))uniform vec2 I;layout((location=198))uniform float F;layout((location=65))uniform float L;layout((location=199))uniform vec2 C;layout((location=117))uniform float D;layout((location=200))uniform float Z;layout((location=201))uniform float Y;layout((location=202))uniform vec3 X;layout((location=64))uniform float V;layout((location=203))uniform vec2 U;layout((location=204))uniform float T;layout((location=205))uniform float R;layout((location=206))uniform float Q;layout((location=207))uniform float P;layout((location=208))uniform float O;layout((location=209))uniform float N;layout((location=210))uniform float K;layout((location=211))uniform float J;layout((location=212))uniform float H;layout((location=213))uniform float G;layout((location=214))uniform float E;layout((location=215))uniform float B;layout((location=216))uniform float A;layout((location=217))uniform vec3 j;layout((location=218))uniform float ab;layout((location=219))uniform vec3 ac;layout((location=220))uniform float ad;layout((location=221))uniform vec2 ae;layout((location=222))uniform vec3 af;layout((location=223))uniform float ag;layout((location=224))uniform float ah;layout((location=225))uniform float ai;layout((location=226))uniform vec2 aj;layout((location=227))uniform float ak;layout((location=228))uniform vec2 al;layout((location=229))uniform float am;layout((location=230))uniform float an;layout((location=231))uniform float ao;layout((location=232))uniform float ap;layout((location=233))uniform float aq;
#line 3"fragment"
out vec3 ar;out float as;layout((location=0))uniform vec2 at;layout((location=66))uniform float au;
#line 2"quat_rotate"
vec3 av[12]=vec3[12](vec3(1,1,0),vec3(-1,1,0),vec3(1,-1,0),vec3(-1,-1,0),vec3(1,0,1),vec3(-1,0,1),vec3(1,0,-1),vec3(-1,0,-1),vec3(0,1,1),vec3(0,-1,1),vec3(0,1,-1),vec3(0,-1,-1));
#line 4"camera"
layout((location=67))uniform vec3 aw;layout((location=68))uniform vec4 ax;layout((location=69))uniform float ay;layout((location=70))uniform float az;float ba=ay/az;
#line 2"helper"
const float bb=3.14159,bc=6.28319,bd=2.71828,be=1.61803,bf=1000.,bg=1./0.;
#line 4"sdf/domain"
#line 3"sdf/operators"
#line 4"material"
struct MaterialId{float id;vec3 coord;vec4 misc;};struct MatWrap{float f;MaterialId m;};struct Material{vec3 color;float roughness;float metallic;float height;vec3 emission;};bool bh=false;float bi=bf;MaterialId bj=MaterialId(0.,vec3(0.),vec4(0.));
#line 5"sdf/distances"
#line 4"lighting"
layout((binding=0))uniform sampler2D bk;layout((binding=1))uniform samplerCube bl;layout((binding=2))uniform samplerCube bm;layout((binding=3))uniform samplerCube bn;struct SphereLight{vec3 position;float radius;vec3 color;float power;};
#line 11"march"
layout((location=132))uniform float bo;layout((location=133))uniform float bp;layout((location=134))uniform vec3 bq;layout((location=135))uniform float br;const float bs=423.;bool bt=true,bu=false,bv=false,bw=false,bx=false,by=false,bz=false,ca=bt,cb=bu;layout((location=136))uniform float cc;
#line 4
const float cd=0.,ce=1.,cf=2.,cg=3.,ch=4.,ci=5.,cj=7.,ck=8.,cl=9.,cm=10.,cn=11.,co=12.,cp=13.,cq=14.;void cr(inout vec3 f,vec4 v){vec3 b=2*cross(v.xyz,f);f+=v.w*b+cross(v.xyz,b);}uint cr(uint f){return f=f+2127912214+(f<<12),f=f^-949894596^f>>19,f=f+374761393+(f<<5),f=f+-744332180^f<<9,f=f+-42973499+(f<<3),f=f^-1252372727^f>>16,f;}float cs(uint v){return float(v%(1<<20))/float(1<<20);}float ct(int v){return cs(cr(v));}float cu(ivec2 v){return cs(cr(v.x+cr(v.y)));}float cv(ivec3 v){return cs(cr(v.x+cr(v.y+cr(v.z))));}float cw(float v){int f=int(floor(v));float b=fract(v),n=cv(f),e=cv(f+1);return mix(n,e,b);}float cx(vec2 v){ivec2 f=ivec2(floor(v));vec2 b=fract(v);float n=0,l=cv(f),e=cv(f+ivec2(0,1)),c=cv(f+ivec2(1,0)),z=cv(f+ivec2(1,1));return mix(mix(l,c,b.x),mix(e,z,b.x),b.y)*2.-1.;}float cy(vec3 v){ivec3 f=ivec3(floor(v));vec3 b=fract(v);float n=0,l=cv(f),e=cv(f+ivec3(0,1,0)),c=cv(f+ivec3(1,0,0)),z=cv(f+ivec3(1,1,0)),i=cv(f+ivec3(0,0,1)),x=cv(f+ivec3(0,1,1)),y=cv(f+ivec3(1,0,1)),a=cv(f+ivec3(1,1,1));return mix(mix(mix(l,c,b.x),mix(e,z,b.x),b.y),mix(mix(i,y,b.x),mix(x,a,b.x),b.y),b.z)*2.-1.;}float cz(vec2 f){float b=.5*(sqrt(3.)-1.);ivec2 v=ivec2(floor(f+(f.x+f.y)*b));float y=(3.-sqrt(3.))/6.;f-=v-(v.x+v.y)*y;ivec2 n=f.x>f.y?ivec2(1,0):ivec2(0,1);vec2 e[3]=vec2[3](f,f-n+y,f-1.+2.*y);ivec3 l=ivec3(v.x)+ivec3(0,n.x,1),c=ivec3(v.y)+ivec3(0,n.y,1);float r=0;for(uint i=0;i<3;i++){float a=max(0,.5-e[i].x*e[i].x-e[i].y*e[i].y);a*=a;uint d=cr(l[i]+cr(c[i]))%12;r+=a*a*dot(av[d].xy,e[i]);}return 70.*r;}float da(vec3 f){float b=1./3.,v=1./6.;ivec3 m=ivec3(floor(f+(f.x+f.y+f.z)*b));f-=m-(m.x+m.y+m.z)*v;vec3 e=step(f.yzx,f);ivec3 n=ivec3(min(e,(1.-e).zxy)),c=ivec3(max(e,(1.-e).zxy));vec3 a[4]=vec3[4](f,f-n+v,f-c+2.*v,f-1.+3.*v);int l[4]=int[4](m.x,m.x+n.x,m.x+c.x,m.x+1),i[4]=int[4](m.y,m.y+n.y,m.y+c.y,m.y+1),d[4]=int[4](m.z,m.z+n.z,m.z+c.z,m.z+1);float r=0;for(uint x=0;x<4;x++){float y=max(0.,.6-a[x].x*a[x].x-a[x].y*a[x].y-a[x].z*a[x].z);y*=y;uint z=cr(l[x]+cr(i[x]+cr(d[x])))%12;r+=y*y*dot(av[z],a[x]);}return 32.*r;}float db(vec2 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*cy(f),f*=2.;return b/1.75;}float dc(vec3 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*cy(f),f*=2.;return b/1.75;}float dd(vec2 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*da(f),f*=2.;return b/1.75;}float de(vec3 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*da(f),f*=2.;return b/1.75;}vec3 cs(vec2 v,out float f){vec3 i=vec3((v-.5*at)/at.x,ay/az);f=length(i.xz);i=normalize(i);return i;}vec3 cr(){vec2 b=vec2(da(vec2(au*L,23)),da(vec2(au*L,283)))*V;vec3 f=cs(gl_FragCoord.xy+b*at,ba);f.z=-f.z;cr(f,ax);return f;}float df(float f){return.5*f/(ba*at.x);}float dg(vec2 f){return min(f.x,f.y);}float dh(vec3 f){return min(min(f.x,f.y),f.z);}float di(vec2 f){return max(f.x,f.y);}float dj(vec3 f){return max(max(f.x,f.y),f.z);}float cr(float v,float f,float b){return min(min(v,f),b);}float cr(float v,float f,float b,float e){return min(min(min(v,f),b),e);}float cs(float v,float f,float b){return max(max(v,f),b);}float cs(float v,float f,float b,float e){return max(max(max(v,f),b),e);}float dk(vec2 f){return f.x+f.y;}float dl(vec3 f){return f.x+f.y+f.z;}float dm(vec2 f){return f.x*f.y;}float dn(vec3 f){return f.x*f.y*f.z;}float do(float f){return f*f;}vec2 dp(vec2 f){return f*f;}vec3 dq(vec3 f){return f*f;}float dr(float f){return 1./f;}vec2 ds(vec2 f){return 1./f;}vec3 dt(vec3 f){return 1./f;}float ct(vec2 f,float v){return pow(dl(pow(abs(f),vec2(v))),1./v);}float cu(vec3 f,float v){return pow(dl(pow(abs(f),vec3(v))),1./v);}float du(float f){return clamp(f,0.,1.);}vec2 dv(vec2 f){return clamp(f,0.,1.);}vec3 dw(vec3 f){return clamp(f,0.,1.);}float ct(float f,float v,float y){return clamp((y-f)/(v-f),0.,1.);}float cu(float f,float v,float y){float b=clamp((y-f)/(v-f),0.,1.);return b*b*b*(b*(b*6.-15.)+10.);}float cv(vec2 v,vec2 f){return max(0.,dot(v,f));}float cw(vec3 v,vec3 f){return max(0.,dot(v,f));}float dx(float f){return f<0.?-1.:1.;}vec2 dy(vec2 f){return vec2(f.x<0.?-1.:1.,f.y<0.?-1.:1.);}vec3 dz(vec3 f){return vec3(f.x<0.?-1.:1.,f.y<0.?-1.:1.,f.z<0.?-1.:1.);}vec2 ea(float f){return vec2(cos(f),sin(f));}vec3 cx(float f,float v){float b=cos(v),y=sin(f),n=sin(v),e=cos(f);return vec3(n*e,b,n*y);}float cv(float f,float e,float v){if(v>f)return v;float b=2.*e-f,n=2.*f-3.*e,c=v/f;return(b*c+n)*c*c+e;}float cy(float f,float v){float b=f*v;return b*exp(1.-b);}float cw(float f,float v,float b){return b=abs(b-f),b/=v,1.-smoothstep(0.,1.,b);}float cx(float f,float v,float e){return exp(-f*pow(e,v));}float cz(float f,float v){return pow(4.*v*(1.-v),f);}float cy(float f,float v,float e){float b=pow(f+v,f+v)/(pow(f,f)*pow(v,v));return b*pow(e,f)*pow(1.-e,v);}float cz(float f,float v,float e){return pow(e,f)*pow(1.-e,v);}float eb(vec3 f){return dot(f,vec3(.2126,.7152,.0722));}vec3 ec(vec3 f){vec4 v=vec4(0.,-1./3.,2./3.,-1.),b=mix(vec4(f.zy,v.wz),vec4(f.yz,v.xy),step(f.z,f.y)),m=mix(vec4(b.xyw,f.x),vec4(f.x,b.yzx),step(b.x,f.x));float n=m.x-min(m.w,m.y),y=1e-10;return vec3(abs(m.z+(m.w-m.y)/(6.*n+y)),n/(m.x+y),m.x);}vec3 ed(vec3 f){vec4 v=vec4(1.,2./3.,1./3.,3.);vec3 b=abs(fract(f.xxx+v.xyz)*6.-v.www);return f.z*mix(v.xxx,clamp(b-v.xxx,0.,1.),f.y);}void da(inout float f,float v){f-=v;}void db(inout vec2 f,vec2 v){f-=v;}void da(inout vec2 f,float v,float b){ct(f,vec2(v,b));}void dc(inout vec3 f,vec3 v){f-=v;}void ct(inout vec3 f,float v,float b,float e){ct(f,vec3(v,b,e));}void dd(inout vec2 f,float v){f*=mat2(cos(v),sin(v),-sin(v),cos(v));}void de(inout vec3 f,float v){dd(f.yz,v);}void df(inout vec3 f,float v){dd(f.zx,v);}void dg(inout vec3 f,float v){dd(f.xy,v);}float dh(inout float f,float v){f+=.5*v;float b=floor(f/v);f=mod(f,v)-.5*v;return b;}vec2 di(inout vec2 f,vec2 v){f+=.5*v;vec2 b=floor(f/v);f=mod(f,v)-.5*v;return b;}vec2 db(inout vec2 f,float v,float b){return cu(f,vec2(v,b));}vec3 dj(inout vec3 f,vec3 v){f+=.5*v;vec3 b=floor(f/v);f=mod(f,v)-.5*v;return b;}vec3 cu(inout vec3 f,float v,float b,float e){return cu(f,vec3(v,b,e));}void dk(inout float f,float v){f*=mod(v,2.)*2.-1.;}void dl(inout vec2 f,vec2 v){f*=mod(v,2.)*2.-1.;}void dm(inout vec3 f,vec3 v){f*=mod(v,2.)*2.-1.;}float dn(inout float f,float v){float b=cu(f,v);f*=mod(b,2.)*2.-1.;return b;}vec2 do(inout vec2 f,vec2 v){vec2 b=cu(f,v);f*=mod(b,2.)*2.-1.;return b;}vec3 dp(inout vec3 f,vec3 v){vec3 b=cu(f,v);f*=mod(b,2.)*2.-1.;return b;}vec2 dq(inout vec2 f,vec2 v){vec2 b=dp(f,v);f-=.5*v;if(f.x>f.y)f.xy=f.yx;return floor(.5*b);}vec3 dr(inout vec3 f,vec3 v){vec3 b=dp(f,v);f-=.5*v;if(f.x<f.y){if(f.y>f.z){if(f.x<f.z)f=f.xzy;else f=f.zxy;}}else{if(f.z<f.y)f=f.zyx;else{if(f.z<f.x)f=f.yzx;else f=f.yxz;}}return floor(.5*b);}float ds(inout float f,float v){float b=.5*v,n=0.;if(f>b)f+=b,n=floor(f/v),f=mod(f,v)-b;return n;}vec2 dt(inout vec2 f,vec2 v){vec2 b=.5*v,n=vec2(0.);if(f.x>b.x)f.x+=b.x,n.x=floor(f.x/v.x),f.x=mod(f.x,v.x)-b.x;if(f.y>b.y)f.y+=b.y,n.y=floor(f.y/v.y),f.y=mod(f.y,v.y)-b.y;return n;}vec3 du(inout vec3 f,vec3 v){vec3 b=.5*v,n=vec3(0.);if(f.x>b.x)f.x+=b.x,n.x=floor(f.x/v.x),f.x=mod(f.x,v.x)-b.x;if(f.y>b.y)f.y+=b.y,n.y=floor(f.y/v.y),f.y=mod(f.y,v.y)-b.y;if(f.z>b.z)f.z+=b.z,n.z=floor(f.z/v.z),f.z=mod(f.z,v.z)-b.z;return n;}float cv(inout float f,float v,float b,float e){f+=.5*v;float i=floor(f/v);f=mod(f,v)-.5*v;if(i>e)f+=v*(i-e),i=e;else if(i<b)f+=v*(i-b),i=b;return i;}vec2 cw(inout vec2 f,vec2 v,vec2 b,vec2 m){f+=.5*v;vec2 i=floor(f/v);f=mod(f,v)-.5*v;if(i.x>m.x)f.x+=v.x*(i.x-m.x),i.x=m.x;else if(i.x<b.x)f.x+=v.x*(i.x-b.x),i.x=b.x;if(i.y>m.y)f.y+=v.y*(i.y-m.y),i.y=m.y;else if(i.y<b.y)f.y+=v.y*(i.y-b.y),i.y=b.y;return i;}vec3 cx(inout vec3 f,vec3 v,vec3 b,vec3 m){f+=.5*v;vec3 i=floor(f/v);f=mod(f,v)-.5*v;if(i.x>m.x)f.x+=v.x*(i.x-m.x),i.x=m.x;else if(i.x<b.x)f.x+=v.x*(i.x-b.x),i.x=b.x;if(i.y>m.y)f.y+=v.y*(i.y-m.y),i.y=m.y;else if(i.y<b.y)f.y+=v.y*(i.y-b.y),i.y=b.y;if(i.z>m.z)f.z+=v.z*(i.z-m.z),i.z=m.z;else if(i.z<b.z)f.z+=v.z*(i.z-b.z),i.z=b.z;return i;}float cy(inout vec2 f,float v,float b,float e){float y=e,n=bc/v,i=cu(y,n),c=length(f);f=c*cx(y);ct(f.x,b);return i;}float dc(inout vec2 f,float v,float b){return cy(f,v,b,atan(f.y,f.x));}float dd(inout vec2 f,float v,float b){float e=length(f),n=floor(e/v);e=mod(e,v);f=e*cx(b);return n;}float dv(inout vec2 f,float v){return dd(f,v,atan(f.y,f.x));}float ee(inout float f){float b=dz(f);f=abs(f);return b;}vec2 ef(inout vec2 f){vec2 b=dz(f);f=abs(f);return b;}vec3 eg(inout vec3 f){vec3 b=dz(f);f=abs(f);return b;}float dw(inout float f,float v){float b=eg(f);ct(f,v);return b;}vec2 dx(inout vec2 f,vec2 v){vec2 b=eg(f);ct(f,v);return b;}vec3 dy(inout vec3 f,vec3 v){vec3 b=eg(f);ct(f,v);return b;}vec3 dz(inout vec2 f,vec2 v){vec3 b;b.xy=dy(f,v);if(f.y>f.x)b.z=-1.,f.xy=f.yx;else b.z=1.;return b;}vec3 ea(inout vec3 f,vec3 v){f=f.zyx;vec3 b=dy(f,v);if(f.x<f.y){if(f.y>f.z){if(f.x<f.z)f=f.xzy;else f=f.zxy;}}else{if(f.z<f.y)f=f.zyx;else{if(f.z<f.x)f=f.yzx;else f=f.yxz;}}f=f.zyx;return b;}vec2 eb(inout vec2 f,float v){vec2 b=f;eg(b);vec2 m=vec2(0);if(b.y>b.x)f=f.yx,m.x=1;m.y=dy(f.x,v);f.y*=m.y;return m;}vec2 ec(inout vec3 f,float v){vec3 b=f;eg(b);vec2 m=vec2(0);if(b.z>b.x||b.y>b.x){if(b.y>b.z)f=f.yxz,m.x=1;else f=f.zyx,m.x=2;}m.y=dy(f.x,v);f.y*=m.y;return m;}float de(inout vec3 f,vec3 v,float b){float y=dot(f,v)+b;if(y<0.)f-=2.*y*v;return dz(y);}float df(inout vec3 f,vec3 v,vec3 b){ct(f,v);float n=dw(dot(f,b)/dot(b,b));f-=b*n;ct(f,-v);return n;}void eh(inout float f){f=-f;}void ei(inout vec2 f){f=-f;}void ej(inout vec3 f){f=-f;}float dg(float f,float v,float b){if(f<b&&v<b){float n=clamp(.5+.5*(v-f)/b,0.,1.),e=mix(v,f,n)-b*n*(1.-n);return e;}float n=min(f,v);return n;}float dh(float f,float v,float b){if(abs(f)<b&&abs(v)<b){float n=clamp(.5-.5*(v-f)/b,0.,1.),e=mix(v,f,n)+b*n*(1.-n);return e;}float n=max(f,v);return n;}float di(float f,float v,float b){return dh(f,-v,b);}float dj(float f,float v,float b){return dg(f,v,b);}float dk(float f,float v,float b){return dh(f,v,b);}float dl(float f,float v,float b){float n=min(f,v);if(f<b&&v<b){vec2 e=vec2(f,v),i=vec2(b);float l=b-distance(i,e);return min(l,n);}return n;}float dm(float f,float v,float b){float n=max(f,v);if(f>-b&&v>-b){vec2 e=vec2(f,v),i=vec2(-b);float l=distance(i,e)-b;return max(l,n);}return n;}float dn(float f,float v,float b){return dm(f,-v,b);}float do(float f,float v,float b){float n=min(f,v),i=sqrt(.5)*(f+v-b);return min(i,n);}float dp(float f,float v,float b){float n=max(f,v),i=sqrt(.5)*(f+v+b);return max(i,n);}float dq(float f,float v,float b){return dp(f,-v,b);}float dr(float f,float v,float b){float e=min(f,v),n=sqrt(.5)*(f+v-b);return dg(n,e,.1*b);}float ds(float f,float v,float b){float e=max(f,v),n=sqrt(.5)*(f+v+b);return dh(n,e,.1*b);}float dt(float f,float v,float b){return ds(f,-v,b);}float cz(float f,float v,float b,float e){float n=min(f,v);if(f<2.*b&&v<2.*b){vec2 i=vec2(f,v);float a=sqrt(.5)*b/(e+sqrt(.5)-1.);i.y-=b-a;dd(i,-bc/8.);cx(i.x,2.*a,0.,e-1.);float l=length(i)-a;l=min(l,i.y);return min(l,n);}return n;}float da(float f,float v,float b,float e){float n=max(f,v);if(f>-b&&v>-b){vec2 i=vec2(f,v);float a=sqrt(.5)*b/(e+sqrt(.5)-1.);i.x-=-b;i.y-=-a;dd(i,-bc/8.);cx(i.x,2.*a,0.,e-1.);float l=length(i)-a;l=min(l,i.y);return max(l,n);}return n;}float db(float f,float v,float b,float e){return da(f,-v,b,e);}float dc(float f,float v,float b,float e){float n=min(f,v);vec2 i=vec2(f,v);float a=b/e*sqrt(.5);i.y-=b-sqrt(.5)*a;i.x-=sqrt(.5)*a;dd(i,-bc/8.);cu(i.x,2.*a);i.x=abs(i.x);float m=a*sqrt(.5),l=dot(i,vec2(sqrt(.5)))-m;l=min(l,i.y);return min(l,n);}float dd(float f,float v,float b,float e){return-dc(-f,-v,b,e);}float de(float f,float v,float b,float e){return dd(f,-v,b,e);}float ed(float f,float v){vec2 b=vec2(f,v);return max(dh(b),0.)-length(min(b,0.));}float ee(float f,float v){vec2 b=vec2(f,v);return min(dj(b),0.)+length(max(b,0.));}float ef(float f,float v){return ee(f,-v);}void eg(float f,MaterialId v){if(bh){if(f<bi)bi=f,bj=v;}else bi=min(bi,f);}void ek(MatWrap f){eh(f.f,f.m);}MatWrap eh(MatWrap f,MatWrap v){return f.f<v.f?f:v;}MatWrap ei(MatWrap f,MatWrap v){return f.f>v.f?f:v;}MatWrap ej(MatWrap f,MatWrap v){return v.f=-v.f,ek(f,v);}void ek(float f,MaterialId v){if(bh){if(f>bi)bi=f,bj=v;}else bi=max(bi,f);}MaterialId el(float f,vec3 v){return MaterialId(f,v,vec4(0.));}Material el(vec3 f){return Material(f,.5,0,0,vec3(0));}void df(float f,MaterialId v,float b,float e){float i=bi,n=sqrt(.5)*(i+f-b);eh(f,v);eh(n,el(e,vec3(i,f,0.)));}void cr(float f,MaterialId v,float b,float e,float i){float n=bi;vec2 l=vec2(n,f);float a=b/e*sqrt(.5);l.y-=b-sqrt(.5)*a;l.x-=sqrt(.5)*a;dd(l,-bc/8.);cu(l.x,2.*a);l.x=abs(l.x);float m=a*sqrt(.5),r=dot(l,vec2(sqrt(.5)))-m;r=min(r,l.y);eh(f,v);eh(r,el(i,vec3(l,0.)));}void dg(MatWrap f,float v,float b,float e){cs(f.f,f.m,v,b,e);}void dh(float f,MaterialId v,float b,float e){float n=bi;if(n<b&&f<b){float y=clamp(.5+.5*(f-n)/b,0.,1.),a=mix(f,n,y)-b*y*(1.-y);bi=a;bj=el(e,vec3(n,f,y));}eh(f,v);}MatWrap di(MatWrap f,MatWrap v,float b,float e){MatWrap i=eh(f,v);float n=sqrt(.5)*(f.f+v.f-b);return eh(i,MatWrap(n,el(e,vec3(f.f,v.f,0.))));}MatWrap dj(MatWrap f,MatWrap v,float b,float e){float n=f.f,i=v.f;if(n<b&&i<b){float y=clamp(.5+.5*(i-n)/b,0.,1.),l=mix(i,n,y)-b*y*(1.-y);return MatWrap(l,el(e,vec3(n,i,0.)));}MatWrap a=eh(f,v);return a;}MatWrap cs(MatWrap f,MatWrap v,float b,float e,float i){float n=f.f,y=v.f;vec2 l=vec2(n,y);float a=b/e*sqrt(.5);l.y-=b-sqrt(.5)*a;l.x-=sqrt(.5)*a;dd(l,-bc/8.);cu(l.x,2.*a);l.x=abs(l.x);float m=a*sqrt(.5),r=dot(l,vec2(sqrt(.5)))-m;r=min(r,l.y);MatWrap c=MatWrap(r,el(i,vec3(l,0.))),x=eh(f,v);x=eh(x,c);return x;}float em(vec3 f,float v){return length(f)-v;}float en(vec2 f,float v){return length(f)-v;}float du(vec3 f,float v,float b){float e=en(f.xz,v),n=abs(f.y)-b;return ee(e,n);}float dv(vec3 f,float v,float b){float e=en(f.xz,v),n=abs(f.y)-b;return max(e,n);}float em(vec3 f){return min(dj(f),0.)+length(max(f,0.));}float eo(vec3 f,float v){return em(f+v)-v;}float en(vec3 f){return dj(f);}float eo(vec2 f){return min(dj(f),0.)+length(max(f,0.));}float ep(vec2 f,float v){return eo(f+v)-v;}float ep(vec2 f){return dj(f);}float eq(vec3 f,vec3 v){vec3 b=abs(f)-v;return min(dj(b),0.)+length(max(b,0.));}float dk(vec3 f,float v,float b,float e){return er(f,vec3(v,b,e));}float er(vec3 f,float v){return er(f,vec3(v));}float dw(vec3 f,vec3 v,float b){return er(f,v-b)-b;}float dx(vec3 f,float v,float b){return dx(f,vec3(v),b);}float es(vec3 f,vec3 v){return dj(abs(f)-v);}float dl(vec3 f,float v,float b,float e){return et(f,vec3(v,b,e));}float et(vec3 f,float v){return et(f,vec3(v));}float eu(vec2 f,vec2 v){vec2 b=abs(f)-v;return min(dj(b),0.)+length(max(b,0.));}float dy(vec2 f,float v,float b){return ev(f,vec2(v,b));}float ev(vec2 f,float v){return ev(f,vec2(v));}float dz(vec2 f,vec2 v,float b){return ev(f,v-b)-b;}float ea(vec2 f,float v,float b){return ea(f,vec2(v),b);}float ew(vec2 f,vec2 v){return dj(abs(f)-v);}float eb(vec2 f,float v,float b){return ex(f,vec2(v,b));}float ex(vec2 f,float v){return ex(f,vec2(v));}float ey(vec3 f,vec3 v){return dot(f,v);}float ec(vec3 f,float v,float b){return ey(f,cx(v,b));}float ez(vec2 f,vec2 v){return dot(f,v);}float fa(vec2 f,float v){return ez(f,cx(v));}float fb(vec2 f,float v){return max(fa(vec2(abs(f.x),f.y),radians(30)),-f.y)-.5*v;}float ed(vec3 f,float v,float b){float e=fb(f.xz,v),n=abs(f.y)-b;return ee(e,n);}float ee(vec3 f,float v,float b){float e=fb(f.xz,v),n=abs(f.y)-b;return max(e,n);}float fc(vec2 f,float v){float b=v*sqrt(.5);vec2 e=abs(f);float n=ez(e,vec2(sqrt(.5)))-b;return n;}float fd(vec2 f,float v){float b=radians(54.),n=radians(-18.),a=v*cos(bc/5./2.);vec2 e=vec2(abs(f.x),f.y);float i=fa(e,b),c=-f.y,y=fa(e,n),o=cs(i,c,y)-a;return o;}float ef(vec3 f,float v,float b){float e=fd(f.xz,v),n=abs(f.y)-b;return ee(e,n);}float eg(vec3 f,float v,float b){float e=fd(f.xz,v),n=abs(f.y)-b;return max(e,n);}float fe(vec2 f,float v){float b=v*cos(bc/6./2.);vec2 e=abs(f);float n=fa(e,radians(30.)),y=e.y,i=max(n,y)-b;return i;}float eh(vec3 f,float v,float b){float e=fe(f.xz,v),n=abs(f.y)-b;return ee(e,n);}float ei(vec3 f,float v,float b){float e=fe(f.xz,v),n=abs(f.y)-b;return max(e,n);}float cr(vec2 f,float v,float b,float e,float y,float n,float m){float a=atan(f.y,f.x),i=length(f),l=e/4.,x=cos(l*a),z=sin(l*a),M=x/v,s=z/b,c=M<0.?-1.:1.,t=s<0.?-1.:1.,d=M*c,p=s*t,r=pow(d,n),S=pow(p,m),h=r/d,w=S/p,o=r+S,k=pow(o,-1./y),u=-n*h*c/v*z,g=m*w*t/b*x,W=l/y*k/o,q=W*W*(u*u+2.*u*g+g*g),I=(i-k)/sqrt(1+q);return I;}float ej(vec3 f,float v,float y){vec2 x=vec2(en(f.xz,v),f.y);return en(x,y);}float ff(vec3 f,vec2 v){return ff(f,v.x,v.y);}float ek(vec3 f,float v,float y){vec2 x=vec2(ex(f.xz,v),f.y);return ev(x,y);}float el(vec3 f,float v,float y){vec2 x=vec2(en(f.xz,v),f.y);return ev(x,y);}float dm(vec3 f,float v,float y,float x){float m=length(f.xz),a=atan(f.z,f.x);a-=clamp(a,-x,x);f.xz=m*cx(a);f.x-=v;return em(f,y);}float fg(vec3 f,vec2 v){vec2 y=vec2(length(f.xz),f.y);return ez(y,v);}float fh(vec3 f,float v){vec2 y=vec2(length(f.xz),f.y);return fa(y,v);}float dn(vec3 f,float v,float y,float x){float m=v-y,a=2*x,z=sqrt(m*m+a*a);vec2 M=vec2(a/z,m/z);vec3 s=f;ct(s.y,y*M.x/M.y+x);float i=fg(s,M),e=abs(f.y)-x;return max(i,e);}float em(vec3 f,float v,vec3 y){float x=dw(dot(f,y)/dot(y,y));return em(f-y*x,v);}float en(vec3 f,float v,float y){return f.x-=clamp(f.x,-y,y),em(f,v);}float do(vec3 f,float v,float y,vec2 x){float m=v*x.x/x.y;f.x=abs(f.x);f.x-=min(y,f.x);f.x-=m;return fg(f.yxz,x);}float dp(vec3 f,float v,float y,float x){return do(f,v,y,cx(x));}float fi(vec3 f,float v){vec3 y=abs(f);y.y-=v;float x=ez(y.xy,vec2(.816497,.57735)),m=ez(y.zy,vec2(.816497,.57735)),a=max(x,m);return a;}float eo(vec3 f,float v,float y){float x=length(f.xz),m=atan(f.z,f.x);x-=m*v/bc;vec2 a=vec2(x,f.y);cu(a.x,v);float z=en(a,y);return z;}float ep(vec2 f,float v,float y){vec2 x=f,m=f;x.x-=v;m.x-=-v;float a=length(x)+length(m);a=a*.5-y;return a;}float eq(vec3 f,float v,float y){vec3 x=f,m=f;x.x-=v;m.x-=-v;float a=length(x)+length(m);a=a*.5-y;return a;}float er(vec3 f,float v,float y){vec3 x=f;x.xz=abs(x.xz);x.y-=v;float m=fa(x.xy,y),a=fa(x.zy,y),z=max(m,a);return z;}vec3 dq(vec3 f,vec3 v,float y,float x){float m=dw(1-x);return normalize(mix(f,v,m*(sqrt(m)+x)));}vec3 dr(vec3 f,vec3 v,vec3 y,float x){float m=dw(dot(f,v));vec3 a=2.*dot(f,v)*f-v,z=dq(f,a,m,sqrt(x)),M=textureLod(bn,z,sqrt(x)*5.).xyz;vec2 s=textureLod(bk,vec2(x,m),0.).xy;return M*(y*s.x+s.y);}vec3 es(vec3 f,vec3 v,Material y){vec3 x=textureLod(bm,f,0.).xyz,m=y.color*x+dr(f,v,vec3(.04),y.roughness),a=dr(f,v,y.color,y.roughness);return mix(m,a,y.metallic);}vec3 et(vec3 f,vec3 v,float y){f.xz-=aw.xz;float x=dq(dot(v,f))-dot(f,f)+y*y,m=-dot(v,f)+sqrt(x);return textureLod(bl,normalize(f+m*v),0.).xyz;}vec3 cr(vec3 f,float v,vec3 y,vec3 x,vec3 m,Material a){return a.color=.5*m+.5,es(m,-y,a);}float eu(vec3 f,vec3 v,SphereLight y){vec3 x=y.position-f;float m=dot(x,x);vec3 a=x*inversesqrt(m);float z=acos(dot(v,a)),M=sqrt(m),s=M/y.radius,i=sqrt(dq(s)-1),e=-i/tan(z),c=0;if(s*cos(z)>1)c=cos(z)/dq(s);else c=1./(bb*dq(s))*(cos(z)*acos(e)-i*sin(z)*sqrt(1-e*e))+1/bb*atan(sin(z)*sqrt(1-dq(e))/i);c*=bb;return c;}vec3 ct(vec3 f,vec3 v,vec3 y,float x,SphereLight m){vec3 a=reflect(-y,v),z=dq(v,a,cw(v,y),x),M=m.position-f,s=dot(M,z)*z-M,i=M+s*dw(m.radius/length(s));return i;}float fj(float f,float v){float y=dq(v),x=(1-y)/y*f;return sqrt(1+x);}float ds(vec3 f,vec3 v,vec3 y,float x){vec3 m=normalize(f+v);float a=cw(y,v),z=cw(y,f),M=cw(y,m),s=dq(x),i=dq(s),e=max(bb*dq(dq(M)*(i-1)+1),1e-08);e*=fj(i,z)+fj(i,a);e*=2*a*z;return max(i/e,0);}vec3 ev(vec3 f,vec3 v,vec3 y){vec3 x=normalize(f+v);float m=cw(f,x);return y+(1-y)*exp2((-5.55473*m-6.98316)*m);}vec3 cs(vec3 f,float v,vec3 y,vec3 x,vec3 m,Material a,SphereLight z){vec3 M=z.position-x;float s=dot(M,M);M/=sqrt(s);float i=cw(M,m),e=z.power/(4*dq(bb)*dq(z.radius));e*=eu(x,m,z);vec3 c=a.color*(max(0,i*e)/bb),n=ct(x,m,-y,a.roughness,z);float t=dw(a.roughness+z.radius/(2*sqrt(s))),l=dot(n,n);n/=sqrt(l);float d=dq(a.roughness/t),p=z.power*d/(4*bb*l);vec3 r=ev(-y,n,a.color);float S=p*i*ds(-y,n,m,a.roughness);vec3 h=ev(-y,n,vec3(.04));return mix(c+h*S,S*r,a.metallic);}float eq(vec3 f){return abs(ey(f,normalize(bq))-br);}void cs(){int f=int(bp);if(f==0)bt=true,bu=false,bv=false,bw=false,bx=false,by=false,bz=false;else if(f==1)bt=true,bu=true,bv=true,bw=false,bx=false,by=false,bz=false;else if(f==2)bt=false,bu=true,bv=true,bw=false,bx=false,by=false,bz=false;else if(f==3)bt=true,bu=false,bv=false,bw=false,bx=true,by=true,bz=false;else if(f==4)bt=true,bu=true,bv=true,bw=false,bx=true,by=true,bz=false;else if(f==5)bt=false,bu=true,bv=true,bw=false,bx=true,by=true,bz=false;else bt=true,bu=false,bv=false,bw=false,bx=false,by=false,bz=false;ca=bt;cb=bu;}vec3 ew(float f,vec3 v,float y){float x=abs(sin(bb*10.*f));x=1.-(1.-smoothstep(8.,15.,y))*(1.-x);float m=abs(sin(bb*f));m=1.-(.8+.2*smoothstep(6.,10.,y))*(1.-smoothstep(60.,80.,y))*(1.-m);float a=abs(sin(bb/10.*f));a=1.-(.8+.2*smoothstep(30.,50.,y))*(1.-smoothstep(80.,150.,y))*(1.-a);float z=eq(v);vec3 M=vec3(0.),s=vec3(.29804,.18824,.43922),i=vec3(.12549,.52941,.36078),e=vec3(.02095,.19046,.60548),c=mix(s,i,smoothstep(.1*z,z,f));if(f<0.)c=e;c=ec(c);c.y*=1.-smoothstep(z,10.*z,abs(f));c=ed(c);c=mix(M,c,x);c=mix(M,c,m);c=mix(M,c,a);return c;}void ex(vec3 f,inout vec3 v,float y){vec3 x=dFdx(f),m=dFdy(f),a=cross(m,v),z=cross(v,x);float M=dot(x,a),s=dFdx(y),i=dFdy(y);vec3 e=(s*a+i*z)*sign(M),c=normalize(abs(M)*v-e);v=c;}float er(float f){f=fract(f);float v=ct(0.,g,f),y=ct(g,g+T,f);y=dq(y)*y;return v-y;}float ct(){return ct(N);}float es(vec3 f){float v=P*ct();vec3 y=f;y.x-=v;float x=er(y,vec3(v,vec2(q)));vec3 m=y;m.x-=v;m.x-=K;float a=er(m,vec3(K,vec2(Q))),z=a;z=min(z,x);return z;}float et(vec3 f){float v=cx(f.z,k,0.,4.);vec3 y=X;y.x*=ct(N-v*w);float x=er(f,y);return x;}float eu(vec3 f){float v=dy(f.z,j.z*2.);f.z=-f.z;if(v>0.)dy(f.z,2.*j.x);df(f,bc*.25*ct());float y=du(f,2.*j.x,j.y);f.xz-=j.xz;float x=er(f,j);return min(x,y);}float ev(vec3 f){f.x-=b.x;vec3 v=f;v.y-=b.y;v.z-=r*ct();float y=er(v,b);vec3 x=f;x.y+=b.y;x.z+=r*ct();float m=er(x,b);return min(y,m);}float ew(vec3 f){ec(f,S+l*ct());vec3 v=f;float y=v.x;v.x=-v.x;y=max(y,er(v.yxz,S,bc*.125));vec3 x=f;x.yz-=t;float m=es(x);vec3 a=f;a.yz-=C;float z=et(a);vec3 M=f;M.yz-=I;float s=eu(M.xzy);vec3 i=f;i.yz-=u;float e=ev(i),c=y;c=min(c,m);c=max(c,-z);c=min(c,s);c=min(c,e);return c;}float ey(vec3 f,float v,float y){vec2 x=vec2(fd(f.xz,v),f.y);return ex(x,y);}float ex(vec3 f){dy(f.xz,vec2(.3));dy(f.xz,vec2(.9));float v=.24;dg(f,v);de(f,-v);float y=fd(f.xz,1);vec3 x=f;ct(x.y,5);float m=ez(x.yz,vec2(1,0));cu(f.y,.9);y=do(y,ey(f,1,.1),.1);return dp(y,m,.1);}float ey(vec3 f){float v=ex(f.xz,vec2(1,2));v=do(v,ex(f.xz,vec2(2,1)),1/(sqrt(2)+1));ct(f.x,-2);return dq(v,ex(f.xz,vec2(.25)),.25);}float fk(vec3 f,float v){dy(f,vec3(Z,v,Z));float y=R,x=J,m=dp(f.x,f.z,y*2);return dd(f.y,m,y,x);}MatWrap ez(vec3 f){float v=f.y;MatWrap y=MatWrap(v,el(co,f));float x=cx(f.z,G*Z,-3,2);x+=2;vec3 m=f;float a=fk(m,R);MatWrap z=MatWrap(a,el(cp,m));vec3 M=m;float s=fract(N+x/6*.5),i=be*Z;ct(M.y,i+ct(s)-R);float e=fk(M,i);MatWrap c=MatWrap(e,el(cq,M));c.m.misc.x=s;MatWrap n=y;n=ej(n,z);n=eh(n,c);return n;}float fl(vec3 f,float v){vec3 y=vec3(f.xy,abs(f.z)),x;x.xz=cos(v)*cx(bc/6);x.y=sin(v);float m=ey(y,x),a=fa(y.xy,bb-v);return max(m,a);}MatWrap fm(vec3 f,float v){dg(f,v);float y=f.x;vec3 x=f;de(x,bc*.1);vec2 m=cu(x.yz,vec2(E));float a=.1+.9*cv(ivec2(m))*(.3+.7*(1.-ct())),z=a*d;vec3 M=vec3(d-z,z,z);float s=et(x,M),i=dp(y,-s,an);return MatWrap(i,el(cl,f));}float fn(vec3 f,float v){eg(f.z);de(f,bc/-12.);f.z-=.5*v;float y=f.z;vec3 x=f;x.x-=A;cu(x.x,ab);float m=ey(x),a=do(y,m,.4);return a;}MatWrap fa(vec3 f){float v=fn(f,o);f.x-=30.;ea(f,vec3(30.,40.,50.));de(f,normalize(ac),length(ac));df(f,bc*p);float y=fn(f,o),x=min(v,y);return MatWrap(x,el(cn,f));}void fb(vec3 f){vec3 v=f;vec2 t=eg(v.xz);vec3 l=v;l.y-=ae.y+ai*ct();de(l,bc*O);dg(l,bc*-O);float d=ep(l.xz)-ae.x;d=max(d,abs(l.y)-ae.y);vec2 p=v.xz;p-=ak*ae.x;float r=ev(p,am*ae.x);vec2 S=v.xz;S-=ah*ae.x;float w=ev(S,ao*ae.x);d=max(d,-min(r,w));eh(d,el(cd,l));vec3 b=l;b.y-=ae.y+U.y;de(b,normalize(vec3(-1,0,1)),0.);df(b,bc*aq);float o=er(b,U.xyx);MatWrap k=MatWrap(o,el(ce,b));vec3 u=b;eg(u.y);u-=H*U.xyx;float g=et(u,n);MatWrap W=MatWrap(g,el(cf,u));k=eh(k,W);di(k.f,k.m,c,cg);vec3 q=v;q.xz-=ak*ae.x;float I;vec3 F=al.xyx;F.y*=dot(t,e)+1.;I=er(q,F);eh(I,el(ch,q));vec3 L=f;ec(L.xz,0.);vec3 C=L;C.x-=ae.x+af.x;C.y-=af.y;float D=er(C,af);eh(D,el(ci,C));vec3 Z=v;Z.xz-=i;df(Z,bc/8);MatWrap Y=ez(Z);eh(Y.f,Y.m);vec3 X=f;ea(X.xz,vec2(0.));X.xz-=aj;df(X,bc*s);ea(X.xz,vec2(0.));df(X,bc*h);float V=ex(X.zy,M);eh(V,el(cj,X));vec3 T=L;T.y-=z.y;T.x-=a;float R=er(T,z);eh(R,el(ck,T));vec3 Q=L;Q.x-=m;MatWrap P=fm(Q,bc*x);P.f=-P.f;vec3 N=Z;N.z-=B;MatWrap K=fm(N.zyx,bc*y);K.f=-K.f;P=di(P,K,an,cm);MatWrap J=fa(N.zyx);P=ej(P,J);di(P.f,P.m,1.,cm);}float fc(vec3 f){return fb(f),bi;}float fo(vec3 f,bool v){bi=bf;bh=v;if(cb)eh(eq(f),el(bs,f));if(ca)fc(f);return bi;}vec3 fp(vec3 f,float v){vec3 y[6]=vec3[6](vec3(v,0,0),vec3(0,v,0),vec3(0,0,v),vec3(-v,0,0),vec3(0,-v,0),vec3(0,0,-v));float x[6]=float[6](0,0,0,0,0,0);for(int m=0;m<6;m++)x[m]=fo(f+y[m],false);return vec3(x[0]-x[3],x[1]-x[4],x[2]-x[5]);}vec3 fq(vec3 f,float v){return normalize(fp(f,v));}vec3 fd(vec3 f){float v=max(5e-05,df(distance(f,aw)));v*=bo;return fd(f,v);}vec3 fr(vec3 f,vec3 v){vec3 y=fd(f);if(dot(v,y)>0.){y=normalize(dFdx(y)+y);if(dot(v,y)>0.)y=normalize(dFdy(y)+y);}return y;}vec3 fs(vec3 f,float v){return fp(f,v)/(2.*v);}vec3 fe(vec3 f){float v=max(5e-05,df(distance(f,aw)));v*=bo;return fe(f,v);}float cr(vec3 f,vec3 v,float y,float x,float m,int a,float z,bool M){float s=y,i=bg,e=y,c=0,n=0,t=dz(fo(f,false));for(int l=0;l<a;++l){float d=t*fo(v*s+f,false),p=abs(d);bool r=z>1&&p+c<n;if(r)n-=z*n,z=1;else n=d*z;c=p;float S=p/s;if(!r&&S<i)e=s,i=S;if(!r&&S<m||s>x){break;}s+=n;}if((s>x||i>m)&&!M)return bg;return e;}float ez(vec3 f,vec3 v,float y){float x=cr(f,v,.001,y,df(1),256,1.2,false);if(isinf(x))return x;for(int m=0;m<3;m++)x+=fo(f+x*v,false)-df(x);return x;}vec3 fa(vec3 f,vec3 v,float y){ca=bv;cb=bw;float x=fo(f,false);vec3 m=fd(f);ca=bt;cb=bu;vec3 a=dFdx(f),z=dFdy(f);int M=5,s=5;vec3 i=vec3(0);for(int e=0;e<s;e++){for(int c=0;c<M;c++){vec2 n=(vec2(c,e)+.5)/vec2(M,s)-.5;vec3 t=n.x*a+n.y*z;float l=x+dot(m,t);i+=ew(l,v,y);}}return i/float(M*s);}vec3 fb(vec3 f,float v,vec3 y){return fa(y,f,v);}vec3 ff(vec3 f){ca=by;cb=bz;vec3 v=fe(f);float y=length(v);ca=bt;cb=bu;vec3 x=vec3(.18014,.74453,.03288),m=vec3(.71547,.03995,.02537),a=vec3(1.);a=mix(a,x,1.-smoothstep(.8,1.,y));a=mix(a,m,smoothstep(1.,1.2,y));return a;}vec3 ct(vec3 f,float v,vec3 y,vec3 x,vec3 m,MaterialId a,Material z){vec3 M=z.emission;return es(m,-y,z)+M;}vec3 dt(vec3 f,float v,vec3 y,vec3 x){return x;}Material fg(MaterialId v){Material y=el(vec3(1));y.roughness=.5;vec3 x=vec3(58,34,29)/255.,m=vec3(89,76,74)/255.,a=vec3(223,157,85)/255.,z=vec3(66,52,37)/255.,M=vec3(215,198,185)/255.;y.color=M;if(v.id==cd||v.id==cf)y.color=x;else if(v.id==ce||v.id==cg)y.color=m;else if(v.id==cl||v.id==cn)y.color=z;else if(v.id==cq)y.color=a;if(v.id==co);if(v.id==cm)y.color=m;if(v.id==ch);if(v.id==ci);if(v.id==cq){vec3 s=v.coord;float i=be*Z;s.y+=i;float e=v.misc.x,c=max(0.,(e-.9)*10.),n=step(.9,e);n*=cy(1.3,4.7,c);n*=1.-smoothstep(F,W,length(s));n=pow(n,Y);y.emission=vec3(1.)*1000.*n*f;}return y;}void main(){cs();vec3 f=aw,v=cr();float y=ez(f,v,cc);if(isinf(y))ar=et(f,v,cc),as=cc;else{vec3 x=f+y*v;float m=fo(x,true);MaterialId a=bj;vec3 z=fr(x,v);if(a.id==bs){vec3 M=fb(f,y,x);if(bx){vec3 s=ff(x);M=mix(M,s,.5);}Material s=el(M);s.roughness=1.;ar=es(z,-v,s);}else{if(bx){vec3 M=ff(x);Material s=el(M);s.roughness=0.;ar=es(z,-v,s);}else{Material M=fg(a);M.roughness=dq(M.roughness);ar=ct(f,y,v,x,z,a,M);}}as=y;}ar=dt(f,y,v,ar);ar*=exp2(D);};
#endif
