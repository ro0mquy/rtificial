#ifndef relaxo_H
#define relaxo_H
const char relaxo_source[] =#version 430
const vec3 f=vec3(1,1,6.155);const float v=2.456;const vec2 m=vec2(80,37.724);const vec3 y=vec3(.7,1.796,50),s=vec3(1.6,2.872,1.6);const float x=.046;const vec2 z=vec2(1.4,.7);const float i=6.379,n=.821,d=1.096,M=17.816,r=.119;const vec3 a=vec3(-200,20,-200);const float c=.142,e=200,g=3.816,l=8,t=91.56,S=5.1;const vec3 p=vec3(-.129,-.192,.036);const vec2 h=vec2(-6.989,0);const float b=150,o=5,w=.896,u=1.08,W=100,q=.619,I=4.715,F=4.8,L=30,k=2.215;layout((location=65))uniform float C;const vec2 D=vec2(39,57),Z=vec2(.112,.236),Y=vec2(45,42);layout((location=117))uniform float X;const float V=8.737;const vec3 U=vec3(40,10,40);const float T=1.044,R=1.08;const vec3 Q=vec3(-350,40,200),P=vec3(1.328,.386,.68);const float O=.752,N=-.05,K=3,J=-2.02,H=.512,G=.78,E=7.18,B=6,A=10,j=-3.57;const vec2 ab=vec2(1.836,1.564);const float ac=.25,ad=.62,ae=.244;const vec3 af=vec3(1.14,1.14,.1);const float ag=.068;layout((location=64))uniform float ah;const float ai=.252;const vec2 aj=vec2(-52.005,1),ak=vec2(50,40);const float al=24,am=25;const vec2 an=vec2(53,48);const float ao=.176,ap=.65,aq=-3,ar=18.676,as=2.5,at=.824;
#line 3"fragment"
out vec3 au;out float av;layout((location=0))uniform vec2 aw;layout((location=66))uniform float ax;
#line 2"quat_rotate"
vec3 ay[12]=vec3[12](vec3(1,1,0),vec3(-1,1,0),vec3(1,-1,0),vec3(-1,-1,0),vec3(1,0,1),vec3(-1,0,1),vec3(1,0,-1),vec3(-1,0,-1),vec3(0,1,1),vec3(0,-1,1),vec3(0,1,-1),vec3(0,-1,-1));
#line 4"camera"
layout((location=67))uniform vec3 az;layout((location=68))uniform vec4 ba;layout((location=69))uniform float bb;layout((location=70))uniform float bc;float bd=bb/bc;
#line 2"helper"
const float be=3.14159,bf=6.28319,bg=2.71828,bh=1.61803,bi=1000.,bj=1./0.;
#line 4"sdf/domain"
#line 3"sdf/operators"
#line 4"material"
struct MaterialId{float id;vec3 coord;vec4 misc;};struct MatWrap{float f;MaterialId m;};struct Material{vec3 color;float roughness;float metallic;float height;vec3 emission;};bool bk=false;float bl=bi;MaterialId bm=MaterialId(0.,vec3(0.),vec4(0.));
#line 5"sdf/distances"
#line 4"lighting"
layout((binding=0))uniform sampler2D bn;layout((binding=1))uniform samplerCube bo;layout((binding=2))uniform samplerCube bp;layout((binding=3))uniform samplerCube bq;struct SphereLight{vec3 position;float radius;vec3 color;float power;};
#line 11"march"
layout((location=132))uniform float br;layout((location=133))uniform float bs;layout((location=134))uniform vec3 bt;layout((location=135))uniform float bu;const float bv=423.;bool bw=true,bx=false,by=false,bz=false,ca=false,cb=false,cc=false,cd=bw,ce=bx;layout((location=136))uniform float cf;
#line 3
const float cg=0.,ch=1.,ci=2.,cj=3.,ck=5.,cl=6.,cm=7.,cn=8.,co=9.,cp=10.,cq=11.,cr=12.,cs=13.,ct=14.,cu=15.,cv=16.,cw=17.,cx=18.,cy=19.,cz=20.;void da(inout vec3 f,vec4 v){vec3 c=2*cross(v.xyz,f);f+=v.w*c+cross(v.xyz,c);}uint da(uint f){return f=f+2127912214+(f<<12),f=f^-949894596^f>>19,f=f+374761393+(f<<5),f=f+-744332180^f<<9,f=f+-42973499+(f<<3),f=f^-1252372727^f>>16,f;}float db(uint v){return float(v%(1<<20))/float(1<<20);}float dc(int v){return db(da(v));}float dd(ivec2 v){return db(da(v.x+da(v.y)));}float de(ivec3 v){return db(da(v.x+da(v.y+da(v.z))));}float df(float v){int f=int(floor(v));float c=fract(v),b=de(f),e=de(f+1);return mix(b,e,c);}float dg(vec2 v){ivec2 f=ivec2(floor(v));vec2 b=fract(v);float c=0,e=de(f),a=de(f+ivec2(0,1)),x=de(f+ivec2(1,0)),z=de(f+ivec2(1,1));return mix(mix(e,x,b.x),mix(a,z,b.x),b.y)*2.-1.;}float dh(vec3 v){ivec3 f=ivec3(floor(v));vec3 b=fract(v);float c=0,e=de(f),a=de(f+ivec3(0,1,0)),x=de(f+ivec3(1,0,0)),z=de(f+ivec3(1,1,0)),i=de(f+ivec3(0,0,1)),d=de(f+ivec3(0,1,1)),y=de(f+ivec3(1,0,1)),n=de(f+ivec3(1,1,1));return mix(mix(mix(e,x,b.x),mix(a,z,b.x),b.y),mix(mix(i,y,b.x),mix(d,n,b.x),b.y),b.z)*2.-1.;}float di(vec2 f){float c=.5*(sqrt(3.)-1.);ivec2 v=ivec2(floor(f+(f.x+f.y)*c));float b=(3.-sqrt(3.))/6.;f-=v-(v.x+v.y)*b;ivec2 a=f.x>f.y?ivec2(1,0):ivec2(0,1);vec2 e[3]=vec2[3](f,f-a+b,f-1.+2.*b);ivec3 i=ivec3(v.x)+ivec3(0,a.x,1),d=ivec3(v.y)+ivec3(0,a.y,1);float r=0;for(uint x=0;x<3;x++){float m=max(0,.5-e[x].x*e[x].x-e[x].y*e[x].y);m*=m;uint n=da(i[x]+da(d[x]))%12;r+=m*m*dot(ay[n].xy,e[x]);}return 70.*r;}float dj(vec3 f){float c=1./3.,b=1./6.;ivec3 v=ivec3(floor(f+(f.x+f.y+f.z)*c));f-=v-(v.x+v.y+v.z)*b;vec3 y=step(f.yzx,f);ivec3 d=ivec3(min(y,(1.-y).zxy)),a=ivec3(max(y,(1.-y).zxy));vec3 e[4]=vec3[4](f,f-d+b,f-a+2.*b,f-1.+3.*b);int i[4]=int[4](v.x,v.x+d.x,v.x+a.x,v.x+1),m[4]=int[4](v.y,v.y+d.y,v.y+a.y,v.y+1),M[4]=int[4](v.z,v.z+d.z,v.z+a.z,v.z+1);float r=0;for(uint x=0;x<4;x++){float s=max(0.,.6-e[x].x*e[x].x-e[x].y*e[x].y-e[x].z*e[x].z);s*=s;uint n=da(i[x]+da(m[x]+da(M[x])))%12;r+=s*s*dot(ay[n],e[x]);}return 32.*r;}float dk(vec2 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*dh(f),f*=2.;return b/1.75;}float dl(vec3 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*dh(f),f*=2.;return b/1.75;}float dm(vec2 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*dj(f),f*=2.;return b/1.75;}float dn(vec3 f){float b=0.;for(int v=0;v<3;v++)b+=exp2(-v)*dj(f),f*=2.;return b/1.75;}vec3 db(vec2 v,out float f){vec3 b=vec3((v-.5*aw)/aw.x,bb/bc);f=length(b.xz);b=normalize(b);return b;}vec3 da(){vec2 f=vec2(dj(vec2(ax*C,23)),dj(vec2(ax*C,283)))*ah;vec3 v=db(gl_FragCoord.xy+f*aw,bd);v.z=-v.z;da(v,ba);return v;}float do(float f){return.5*f/(bd*aw.x);}float dp(vec2 f){return min(f.x,f.y);}float dq(vec3 f){return min(min(f.x,f.y),f.z);}float dr(vec2 f){return max(f.x,f.y);}float ds(vec3 f){return max(max(f.x,f.y),f.z);}float da(float v,float f,float b){return min(min(v,f),b);}float da(float v,float f,float e,float b){return min(min(min(v,f),e),b);}float db(float v,float f,float b){return max(max(v,f),b);}float db(float v,float f,float b,float c){return max(max(max(v,f),b),c);}float dt(vec2 f){return f.x+f.y;}float du(vec3 f){return f.x+f.y+f.z;}float dv(vec2 f){return f.x*f.y;}float dw(vec3 f){return f.x*f.y*f.z;}float dx(float f){return f*f;}vec2 dy(vec2 f){return f*f;}vec3 dz(vec3 f){return f*f;}float ea(float f){return 1./f;}vec2 eb(vec2 f){return 1./f;}vec3 ec(vec3 f){return 1./f;}float dc(vec2 v,float f){return pow(du(pow(abs(v),vec2(f))),1./f);}float dd(vec3 v,float f){return pow(du(pow(abs(v),vec3(f))),1./f);}float ed(float v){return clamp(v,0.,1.);}vec2 ee(vec2 v){return clamp(v,0.,1.);}vec3 ef(vec3 v){return clamp(v,0.,1.);}float dc(float f,float v,float y){return clamp((y-f)/(v-f),0.,1.);}float dd(float f,float v,float y){float b=clamp((y-f)/(v-f),0.,1.);return b*b*b*(b*(b*6.-15.)+10.);}float de(vec2 v,vec2 f){return max(0.,dot(v,f));}float df(vec3 v,vec3 f){return max(0.,dot(v,f));}float eg(float f){return f<0.?-1.:1.;}vec2 eh(vec2 f){return vec2(f.x<0.?-1.:1.,f.y<0.?-1.:1.);}vec3 ei(vec3 f){return vec3(f.x<0.?-1.:1.,f.y<0.?-1.:1.,f.z<0.?-1.:1.);}vec2 ej(float v){return vec2(cos(v),sin(v));}vec3 dg(float v,float f){float b=cos(f),c=sin(v),a=sin(f),e=cos(v);return vec3(a*e,b,a*c);}float de(float f,float v,float b){if(b>f)return b;float c=2.*v-f,y=2.*f-3.*v,a=b/f;return(c*a+y)*a*a+v;}float dh(float f,float v){float b=f*v;return b*exp(1.-b);}float df(float f,float v,float b){return b=abs(b-f),b/=v,1.-smoothstep(0.,1.,b);}float dg(float f,float v,float b){return exp(-f*pow(b,v));}float di(float f,float v){return pow(4.*v*(1.-v),f);}float dh(float f,float v,float b){float c=pow(f+v,f+v)/(pow(f,f)*pow(v,v));return c*pow(b,f)*pow(1.-b,v);}float di(float f,float v,float b){return pow(b,f)*pow(1.-b,v);}float ek(vec3 v){return dot(v,vec3(.2126,.7152,.0722));}vec3 el(vec3 f){vec4 v=vec4(0.,-1./3.,2./3.,-1.),b=mix(vec4(f.zy,v.wz),vec4(f.yz,v.xy),step(f.z,f.y)),c=mix(vec4(b.xyw,f.x),vec4(f.x,b.yzx),step(b.x,f.x));float a=c.x-min(c.w,c.y),y=1e-10;return vec3(abs(c.z+(c.w-c.y)/(6.*a+y)),a/(c.x+y),c.x);}vec3 em(vec3 f){vec4 v=vec4(1.,2./3.,1./3.,3.);vec3 b=abs(fract(f.xxx+v.xyz)*6.-v.www);return f.z*mix(v.xxx,clamp(b-v.xxx,0.,1.),f.y);}void dj(inout float f,float v){f-=v;}void dk(inout vec2 f,vec2 v){f-=v;}void dj(inout vec2 v,float f,float b){dc(v,vec2(f,b));}void dl(inout vec3 f,vec3 v){f-=v;}void dc(inout vec3 v,float f,float b,float c){dc(v,vec3(f,b,c));}void dm(inout vec2 f,float v){f*=mat2(cos(v),sin(v),-sin(v),cos(v));}void dn(inout vec3 v,float f){dm(v.yz,f);}void do(inout vec3 v,float f){dm(v.zx,f);}void dp(inout vec3 v,float f){dm(v.xy,f);}float dq(inout float f,float v){f+=.5*v;float b=floor(f/v);f=mod(f,v)-.5*v;return b;}vec2 dr(inout vec2 f,vec2 v){f+=.5*v;vec2 b=floor(f/v);f=mod(f,v)-.5*v;return b;}vec2 dk(inout vec2 v,float f,float b){return dd(v,vec2(f,b));}vec3 ds(inout vec3 f,vec3 v){f+=.5*v;vec3 b=floor(f/v);f=mod(f,v)-.5*v;return b;}vec3 dd(inout vec3 v,float f,float b,float c){return dd(v,vec3(f,b,c));}void dt(inout float f,float v){f*=mod(v,2.)*2.-1.;}void du(inout vec2 f,vec2 v){f*=mod(v,2.)*2.-1.;}void dv(inout vec3 f,vec3 v){f*=mod(v,2.)*2.-1.;}float dw(inout float v,float f){float b=dd(v,f);v*=mod(b,2.)*2.-1.;return b;}vec2 dx(inout vec2 v,vec2 f){vec2 b=dd(v,f);v*=mod(b,2.)*2.-1.;return b;}vec3 dy(inout vec3 v,vec3 f){vec3 b=dd(v,f);v*=mod(b,2.)*2.-1.;return b;}vec2 dz(inout vec2 f,vec2 v){vec2 b=dy(f,v);f-=.5*v;if(f.x>f.y)f.xy=f.yx;return floor(.5*b);}vec3 ea(inout vec3 f,vec3 v){vec3 b=dy(f,v);f-=.5*v;if(f.x<f.y){if(f.y>f.z){if(f.x<f.z)f=f.xzy;else f=f.zxy;}}else{if(f.z<f.y)f=f.zyx;else{if(f.z<f.x)f=f.yzx;else f=f.yxz;}}return floor(.5*b);}float eb(inout float f,float v){float b=.5*v,c=0.;if(f>b)f+=b,c=floor(f/v),f=mod(f,v)-b;return c;}vec2 ec(inout vec2 f,vec2 v){vec2 b=.5*v,c=vec2(0.);if(f.x>b.x)f.x+=b.x,c.x=floor(f.x/v.x),f.x=mod(f.x,v.x)-b.x;if(f.y>b.y)f.y+=b.y,c.y=floor(f.y/v.y),f.y=mod(f.y,v.y)-b.y;return c;}vec3 ed(inout vec3 f,vec3 v){vec3 b=.5*v,c=vec3(0.);if(f.x>b.x)f.x+=b.x,c.x=floor(f.x/v.x),f.x=mod(f.x,v.x)-b.x;if(f.y>b.y)f.y+=b.y,c.y=floor(f.y/v.y),f.y=mod(f.y,v.y)-b.y;if(f.z>b.z)f.z+=b.z,c.z=floor(f.z/v.z),f.z=mod(f.z,v.z)-b.z;return c;}float de(inout float f,float v,float b,float m){f+=.5*v;float c=floor(f/v);f=mod(f,v)-.5*v;if(c>m)f+=v*(c-m),c=m;else if(c<b)f+=v*(c-b),c=b;return c;}vec2 df(inout vec2 f,vec2 v,vec2 b,vec2 m){f+=.5*v;vec2 c=floor(f/v);f=mod(f,v)-.5*v;if(c.x>m.x)f.x+=v.x*(c.x-m.x),c.x=m.x;else if(c.x<b.x)f.x+=v.x*(c.x-b.x),c.x=b.x;if(c.y>m.y)f.y+=v.y*(c.y-m.y),c.y=m.y;else if(c.y<b.y)f.y+=v.y*(c.y-b.y),c.y=b.y;return c;}vec3 dg(inout vec3 f,vec3 v,vec3 b,vec3 m){f+=.5*v;vec3 c=floor(f/v);f=mod(f,v)-.5*v;if(c.x>m.x)f.x+=v.x*(c.x-m.x),c.x=m.x;else if(c.x<b.x)f.x+=v.x*(c.x-b.x),c.x=b.x;if(c.y>m.y)f.y+=v.y*(c.y-m.y),c.y=m.y;else if(c.y<b.y)f.y+=v.y*(c.y-b.y),c.y=b.y;if(c.z>m.z)f.z+=v.z*(c.z-m.z),c.z=m.z;else if(c.z<b.z)f.z+=v.z*(c.z-b.z),c.z=b.z;return c;}float dh(inout vec2 f,float v,float b,float m){float c=m,y=bf/v,a=dd(c,y),e=length(f);f=e*dg(c);dc(f.x,b);return a;}float dl(inout vec2 f,float v,float b){return dh(f,v,b,atan(f.y,f.x));}float dm(inout vec2 f,float v,float b){float c=length(f),a=floor(c/v);c=mod(c,v);f=c*dg(b);return a;}float ee(inout vec2 f,float v){return dm(f,v,atan(f.y,f.x));}float en(inout float f){float b=ei(f);f=abs(f);return b;}vec2 eo(inout vec2 f){vec2 b=ei(f);f=abs(f);return b;}vec3 ep(inout vec3 f){vec3 b=ei(f);f=abs(f);return b;}float ef(inout float f,float v){float b=ep(f);dc(f,v);return b;}vec2 eg(inout vec2 f,vec2 v){vec2 b=ep(f);dc(f,v);return b;}vec3 eh(inout vec3 f,vec3 v){vec3 b=ep(f);dc(f,v);return b;}vec3 ei(inout vec2 f,vec2 v){vec3 b;b.xy=eh(f,v);if(f.y>f.x)b.z=-1.,f.xy=f.yx;else b.z=1.;return b;}vec3 ej(inout vec3 f,vec3 v){f=f.zyx;vec3 b=eh(f,v);if(f.x<f.y){if(f.y>f.z){if(f.x<f.z)f=f.xzy;else f=f.zxy;}}else{if(f.z<f.y)f=f.zyx;else{if(f.z<f.x)f=f.yzx;else f=f.yxz;}}f=f.zyx;return b;}vec2 ek(inout vec2 f,float v){vec2 b=f;ep(b);vec2 c=vec2(0);if(b.y>b.x)f=f.yx,c.x=1;c.y=eh(f.x,v);f.y*=c.y;return c;}vec2 el(inout vec3 f,float v){vec3 b=f;ep(b);vec2 c=vec2(0);if(b.z>b.x||b.y>b.x){if(b.y>b.z)f=f.yxz,c.x=1;else f=f.zyx,c.x=2;}c.y=eh(f.x,v);f.y*=c.y;return c;}float dn(inout vec3 f,vec3 v,float b){float c=dot(f,v)+b;if(c<0.)f-=2.*c*v;return ei(c);}float do(inout vec3 f,vec3 v,vec3 b){dc(f,v);float c=ef(dot(f,b)/dot(b,b));f-=b*c;dc(f,-v);return c;}void eq(inout float f){f=-f;}void er(inout vec2 f){f=-f;}void es(inout vec3 f){f=-f;}float dp(float f,float v,float b){if(f<b&&v<b){float c=clamp(.5+.5*(v-f)/b,0.,1.),a=mix(v,f,c)-b*c*(1.-c);return a;}float c=min(f,v);return c;}float dq(float f,float v,float b){if(abs(f)<b&&abs(v)<b){float c=clamp(.5-.5*(v-f)/b,0.,1.),a=mix(v,f,c)+b*c*(1.-c);return a;}float c=max(f,v);return c;}float dr(float f,float v,float b){return dq(f,-v,b);}float ds(float f,float v,float b){return dp(f,v,b);}float dt(float f,float v,float b){return dq(f,v,b);}float du(float f,float v,float b){float c=min(f,v);if(f<b&&v<b){vec2 a=vec2(f,v),e=vec2(b);float i=b-distance(e,a);return min(i,c);}return c;}float dv(float f,float v,float b){float c=max(f,v);if(f>-b&&v>-b){vec2 a=vec2(f,v),e=vec2(-b);float i=distance(e,a)-b;return max(i,c);}return c;}float dw(float f,float v,float b){return dv(f,-v,b);}float dx(float f,float v,float b){float c=min(f,v),a=sqrt(.5)*(f+v-b);return min(a,c);}float dy(float f,float v,float b){float c=max(f,v),a=sqrt(.5)*(f+v+b);return max(a,c);}float dz(float f,float v,float b){return dy(f,-v,b);}float ea(float f,float v,float b){float c=min(f,v),a=sqrt(.5)*(f+v-b);return dp(a,c,.1*b);}float eb(float f,float v,float b){float c=max(f,v),a=sqrt(.5)*(f+v+b);return dq(a,c,.1*b);}float ec(float f,float v,float b){return eb(f,-v,b);}float di(float f,float v,float b,float c){float a=min(f,v);if(f<2.*b&&v<2.*b){vec2 e=vec2(f,v);float x=sqrt(.5)*b/(c+sqrt(.5)-1.);e.y-=b-x;dm(e,-bf/8.);dg(e.x,2.*x,0.,c-1.);float i=length(e)-x;i=min(i,e.y);return min(i,a);}return a;}float dj(float f,float v,float b,float c){float a=max(f,v);if(f>-b&&v>-b){vec2 e=vec2(f,v);float x=sqrt(.5)*b/(c+sqrt(.5)-1.);e.x-=-b;e.y-=-x;dm(e,-bf/8.);dg(e.x,2.*x,0.,c-1.);float i=length(e)-x;i=min(i,e.y);return max(i,a);}return a;}float dk(float f,float v,float b,float c){return dj(f,-v,b,c);}float dl(float f,float v,float b,float c){float a=min(f,v);vec2 e=vec2(f,v);float m=b/c*sqrt(.5);e.y-=b-sqrt(.5)*m;e.x-=sqrt(.5)*m;dm(e,-bf/8.);dd(e.x,2.*m);e.x=abs(e.x);float d=m*sqrt(.5),i=dot(e,vec2(sqrt(.5)))-d;i=min(i,e.y);return min(i,a);}float dm(float f,float v,float b,float c){return-dl(-f,-v,b,c);}float dn(float f,float v,float b,float c){return dm(f,-v,b,c);}float em(float f,float v){vec2 b=vec2(f,v);return max(dq(b),0.)-length(min(b,0.));}float en(float f,float v){vec2 b=vec2(f,v);return min(ds(b),0.)+length(max(b,0.));}float eo(float f,float v){return en(f,-v);}void ep(float f,MaterialId v){if(bk){if(f<bl)bl=f,bm=v;}else bl=min(bl,f);}void et(MatWrap f){eq(f.f,f.m);}MatWrap eq(MatWrap f,MatWrap v){return f.f<v.f?f:v;}MatWrap er(MatWrap f,MatWrap v){return f.f>v.f?f:v;}MatWrap es(MatWrap f,MatWrap v){return v.f=-v.f,et(f,v);}void et(float f,MaterialId v){if(bk){if(f>bl)bl=f,bm=v;}else bl=max(bl,f);}MaterialId eu(float f,vec3 v){return MaterialId(f,v,vec4(0.));}Material eu(vec3 f){return Material(f,.5,0,0,vec3(0));}void do(float f,MaterialId v,float b,float c){float e=bl,a=sqrt(.5)*(e+f-b);eq(f,v);eq(a,eu(c,vec3(e,f,0.)));}void da(float f,MaterialId v,float b,float e,float c){float i=bl;vec2 a=vec2(i,f);float m=b/e*sqrt(.5);a.y-=b-sqrt(.5)*m;a.x-=sqrt(.5)*m;dm(a,-bf/8.);dd(a.x,2.*m);a.x=abs(a.x);float d=m*sqrt(.5),r=dot(a,vec2(sqrt(.5)))-d;r=min(r,a.y);eq(f,v);eq(r,eu(c,vec3(a,0.)));}void dp(MatWrap f,float v,float b,float c){db(f.f,f.m,v,b,c);}void dq(float f,MaterialId v,float b,float c){float a=bl;if(a<b&&f<b){float y=clamp(.5+.5*(f-a)/b,0.,1.),m=mix(f,a,y)-b*y*(1.-y);bl=m;bm=eu(c,vec3(a,f,y));}eq(f,v);}MatWrap dr(MatWrap f,MatWrap v,float b,float c){MatWrap e=eq(f,v);float a=sqrt(.5)*(f.f+v.f-b);return eq(e,MatWrap(a,eu(c,vec3(f.f,v.f,0.))));}MatWrap ds(MatWrap f,MatWrap v,float b,float c){float a=f.f,e=v.f;if(a<b&&e<b){float y=clamp(.5+.5*(e-a)/b,0.,1.),i=mix(e,a,y)-b*y*(1.-y);return MatWrap(i,eu(c,vec3(a,e,0.)));}MatWrap d=eq(f,v);return d;}MatWrap db(MatWrap f,MatWrap v,float b,float e,float c){float a=f.f,y=v.f;vec2 i=vec2(a,y);float m=b/e*sqrt(.5);i.y-=b-sqrt(.5)*m;i.x-=sqrt(.5)*m;dm(i,-bf/8.);dd(i.x,2.*m);i.x=abs(i.x);float d=m*sqrt(.5),r=dot(i,vec2(sqrt(.5)))-d;r=min(r,i.y);MatWrap x=MatWrap(r,eu(c,vec3(i,0.))),z=eq(f,v);z=eq(z,x);return z;}float ev(vec3 f,float v){return length(f)-v;}float ew(vec2 f,float v){return length(f)-v;}float ed(vec3 f,float v,float b){float c=ew(f.xz,v),a=abs(f.y)-b;return en(c,a);}float ee(vec3 f,float v,float b){float c=ew(f.xz,v),a=abs(f.y)-b;return max(c,a);}float ev(vec3 f){return min(ds(f),0.)+length(max(f,0.));}float ex(vec3 f,float v){return ev(f+v)-v;}float ew(vec3 f){return ds(f);}float ex(vec2 f){return min(ds(f),0.)+length(max(f,0.));}float ey(vec2 f,float v){return ex(f+v)-v;}float ey(vec2 f){return ds(f);}float ez(vec3 f,vec3 v){vec3 b=abs(f)-v;return min(ds(b),0.)+length(max(b,0.));}float dt(vec3 f,float v,float b,float c){return fa(f,vec3(v,b,c));}float fa(vec3 f,float v){return fa(f,vec3(v));}float ef(vec3 f,vec3 v,float b){return fa(f,v-b)-b;}float eg(vec3 f,float v,float b){return eg(f,vec3(v),b);}float fb(vec3 f,vec3 v){return ds(abs(f)-v);}float du(vec3 f,float v,float b,float c){return fc(f,vec3(v,b,c));}float fc(vec3 f,float v){return fc(f,vec3(v));}float fd(vec2 f,vec2 v){vec2 b=abs(f)-v;return min(ds(b),0.)+length(max(b,0.));}float eh(vec2 f,float v,float b){return fe(f,vec2(v,b));}float fe(vec2 f,float v){return fe(f,vec2(v));}float ei(vec2 f,vec2 v,float b){return fe(f,v-b)-b;}float ej(vec2 f,float v,float b){return ej(f,vec2(v),b);}float ff(vec2 f,vec2 v){return ds(abs(f)-v);}float ek(vec2 f,float v,float b){return fg(f,vec2(v,b));}float fg(vec2 f,float v){return fg(f,vec2(v));}float fh(vec3 f,vec3 v){return dot(f,v);}float el(vec3 f,float v,float b){return fh(f,dg(v,b));}float fi(vec2 f,vec2 v){return dot(f,v);}float fj(vec2 f,float v){return fi(f,dg(v));}float fk(vec2 f,float v){return max(fj(vec2(abs(f.x),f.y),radians(30)),-f.y)-.5*v;}float em(vec3 f,float v,float b){float c=fk(f.xz,v),a=abs(f.y)-b;return en(c,a);}float en(vec3 f,float v,float b){float c=fk(f.xz,v),a=abs(f.y)-b;return max(c,a);}float fl(vec2 f,float v){float b=v*sqrt(.5);vec2 c=abs(f);float a=fi(c,vec2(sqrt(.5)))-b;return a;}float fm(vec2 f,float v){float b=radians(54.),c=radians(-18.),a=v*cos(bf/5./2.);vec2 e=vec2(abs(f.x),f.y);float i=fj(e,b),x=-f.y,y=fj(e,c),o=db(i,x,y)-a;return o;}float eo(vec3 f,float v,float b){float c=fm(f.xz,v),a=abs(f.y)-b;return en(c,a);}float ep(vec3 f,float v,float b){float c=fm(f.xz,v),a=abs(f.y)-b;return max(c,a);}float fn(vec2 f,float v){float b=v*cos(bf/6./2.);vec2 c=abs(f);float a=fj(c,radians(30.)),y=c.y,e=max(a,y)-b;return e;}float eq(vec3 f,float v,float b){float c=fn(f.xz,v),a=abs(f.y)-b;return en(c,a);}float er(vec3 f,float v,float b){float c=fn(f.xz,v),a=abs(f.y)-b;return max(c,a);}float da(vec2 f,float v,float b,float c,float y,float e,float a){float x=atan(f.y,f.x),i=length(f),m=c/4.,s=cos(m*x),z=sin(m*x),n=s/v,d=z/b,M=n<0.?-1.:1.,r=d<0.?-1.:1.,g=n*M,l=d*r,t=pow(g,e),S=pow(l,a),p=t/g,h=S/l,o=t+S,w=pow(o,-1./y),u=-e*p*M/v*z,W=a*h*r/b*s,q=m/y*w/o,I=q*q*(u*u+2.*u*W+W*W),F=(i-w)/sqrt(1+I);return F;}float es(vec3 f,float v,float m){vec2 y=vec2(ew(f.xz,v),f.y);return ew(y,m);}float fo(vec3 f,vec2 v){return fo(f,v.x,v.y);}float et(vec3 f,float v,float m){vec2 y=vec2(fg(f.xz,v),f.y);return fe(y,m);}float eu(vec3 f,float v,float m){vec2 y=vec2(ew(f.xz,v),f.y);return fe(y,m);}float dv(vec3 f,float v,float m,float y){float s=length(f.xz),x=atan(f.z,f.x);x-=clamp(x,-y,y);f.xz=s*dg(x);f.x-=v;return ev(f,m);}float fp(vec3 f,vec2 v){vec2 m=vec2(length(f.xz),f.y);return fi(m,v);}float fq(vec3 f,float v){vec2 m=vec2(length(f.xz),f.y);return fj(m,v);}float dw(vec3 f,float v,float m,float y){float s=v-m,x=2*y,z=sqrt(s*s+x*x);vec2 i=vec2(x/z,s/z);vec3 n=f;dc(n.y,m*i.x/i.y+y);float d=fp(n,i),M=abs(f.y)-y;return max(d,M);}float ev(vec3 f,float v,vec3 m){float y=ef(dot(f,m)/dot(m,m));return ev(f-m*y,v);}float ew(vec3 f,float v,float m){return f.x-=clamp(f.x,-m,m),ev(f,v);}float dx(vec3 f,float v,float m,vec2 y){float s=v*y.x/y.y;f.x=abs(f.x);f.x-=min(m,f.x);f.x-=s;return fp(f.yxz,y);}float dy(vec3 f,float v,float m,float y){return dx(f,v,m,dg(y));}float fr(vec3 f,float v){vec3 m=abs(f);m.y-=v;float y=fi(m.xy,vec2(.816497,.57735)),s=fi(m.zy,vec2(.816497,.57735)),x=max(y,s);return x;}float ex(vec3 f,float v,float m){float y=length(f.xz),s=atan(f.z,f.x);y-=s*v/bf;vec2 x=vec2(y,f.y);dd(x.x,v);float z=ew(x,m);return z;}float ey(vec2 f,float v,float m){vec2 y=f,s=f;y.x-=v;s.x-=-v;float x=length(y)+length(s);x=x*.5-m;return x;}float ez(vec3 f,float v,float m){vec3 y=f,s=f;y.x-=v;s.x-=-v;float x=length(y)+length(s);x=x*.5-m;return x;}float fa(vec3 f,float v,float m){vec3 y=f;y.xz=abs(y.xz);y.y-=v;float s=fj(y.xy,m),x=fj(y.zy,m),z=max(s,x);return z;}vec3 dz(vec3 f,vec3 v,float m,float y){float s=ef(1-y);return normalize(mix(f,v,s*(sqrt(s)+y)));}vec3 ea(vec3 f,vec3 v,vec3 m,float y){float s=ef(dot(f,v));vec3 x=2.*dot(f,v)*f-v,z=dz(f,x,s,sqrt(y)),i=textureLod(bq,z,sqrt(y)*5.).xyz;vec2 n=textureLod(bn,vec2(y,s),0.).xy;return i*(m*n.x+n.y);}vec3 fb(vec3 f,vec3 v,Material m){vec3 y=textureLod(bp,f,0.).xyz,s=m.color*y+ea(f,v,vec3(.04),m.roughness),x=ea(f,v,m.color,m.roughness);return mix(s,x,m.metallic);}vec3 fc(vec3 f,vec3 v,float m){f.xz-=az.xz;float y=dz(dot(v,f))-dot(f,f)+m*m,s=-dot(v,f)+sqrt(y);return textureLod(bo,normalize(f+s*v),0.).xyz;}vec3 da(vec3 f,float v,vec3 m,vec3 y,vec3 s,Material x){return x.color=.5*s+.5,fb(s,-m,x);}float fd(vec3 f,vec3 v,SphereLight m){vec3 y=m.position-f;float s=dot(y,y);vec3 x=y*inversesqrt(s);float z=acos(dot(v,x)),i=sqrt(s),n=i/m.radius,d=sqrt(dz(n)-1),M=-d/tan(z),r=0;if(n*cos(z)>1)r=cos(z)/dz(n);else r=1./(be*dz(n))*(cos(z)*acos(M)-d*sin(z)*sqrt(1-M*M))+1/be*atan(sin(z)*sqrt(1-dz(M))/d);r*=be;return r;}vec3 dc(vec3 f,vec3 v,vec3 m,float y,SphereLight s){vec3 x=reflect(-m,v),z=dz(v,x,df(v,m),y),i=s.position-f,n=dot(i,z)*z-i,d=i+n*ef(s.radius/length(n));return d;}float fs(float f,float v){float m=dz(v),y=(1-m)/m*f;return sqrt(1+y);}float eb(vec3 f,vec3 v,vec3 m,float y){vec3 s=normalize(f+v);float x=df(m,v),z=df(m,f),i=df(m,s),n=dz(y),d=dz(n),M=max(be*dz(dz(i)*(d-1)+1),1e-08);M*=fs(d,z)+fs(d,x);M*=2*x*z;return max(d/M,0);}vec3 fe(vec3 f,vec3 v,vec3 m){vec3 y=normalize(f+v);float s=df(f,y);return m+(1-m)*exp2((-5.55473*s-6.98316)*s);}vec3 db(vec3 f,float v,vec3 m,vec3 y,vec3 s,Material x,SphereLight z){vec3 i=z.position-y;float n=dot(i,i);i/=sqrt(n);float d=df(i,s),M=z.power/(4*dz(be)*dz(z.radius));M*=fd(y,s,z);vec3 r=x.color*(max(0,d*M)/be),a=dc(y,s,-m,x.roughness,z);float c=ef(x.roughness+z.radius/(2*sqrt(n))),e=dot(a,a);a/=sqrt(e);float g=dz(x.roughness/c),l=z.power*g/(4*be*e);vec3 t=fe(-m,a,x.color);float S=l*d*eb(-m,a,s,x.roughness);vec3 p=fe(-m,a,vec3(.04));return mix(r+p*S,S*t,x.metallic);}float ez(vec3 f){return abs(fh(f,normalize(bt))-bu);}void db(){int f=int(bs);if(f==0)bw=true,bx=false,by=false,bz=false,ca=false,cb=false,cc=false;else if(f==1)bw=true,bx=true,by=true,bz=false,ca=false,cb=false,cc=false;else if(f==2)bw=false,bx=true,by=true,bz=false,ca=false,cb=false,cc=false;else if(f==3)bw=true,bx=false,by=false,bz=false,ca=true,cb=true,cc=false;else if(f==4)bw=true,bx=true,by=true,bz=false,ca=true,cb=true,cc=false;else if(f==5)bw=false,bx=true,by=true,bz=false,ca=true,cb=true,cc=false;else bw=true,bx=false,by=false,bz=false,ca=false,cb=false,cc=false;cd=bw;ce=bx;}vec3 ff(float f,vec3 v,float m){float y=abs(sin(be*10.*f));y=1.-(1.-smoothstep(8.,15.,m))*(1.-y);float s=abs(sin(be*f));s=1.-(.8+.2*smoothstep(6.,10.,m))*(1.-smoothstep(60.,80.,m))*(1.-s);float x=abs(sin(be/10.*f));x=1.-(.8+.2*smoothstep(30.,50.,m))*(1.-smoothstep(80.,150.,m))*(1.-x);float z=ez(v);vec3 i=vec3(0.),n=vec3(.29804,.18824,.43922),d=vec3(.12549,.52941,.36078),M=vec3(.02095,.19046,.60548),r=mix(n,d,smoothstep(.1*z,z,f));if(f<0.)r=M;r=el(r);r.y*=1.-smoothstep(z,10.*z,abs(f));r=em(r);r=mix(i,r,y);r=mix(i,r,s);r=mix(i,r,x);return r;}void fg(vec3 f,inout vec3 v,float m){vec3 y=dFdx(f),s=dFdy(f),x=cross(s,v),z=cross(v,y);float i=dot(y,x),n=dFdx(m),d=dFdy(m);vec3 M=(n*x+d*z)*sign(i),r=normalize(abs(i)*v-M);v=r;}float fa(vec3 f){float v=ed(f,w,I);if(v>1.)return v;vec3 m=f;float y=ed(m,ac,K);vec3 s=f;s.y-=K;eh(s,vec3(.1));dn(s,normalize(p),length(p));float x=fc(s,P);vec3 z=f;z.y-=K;dn(z,bf*N);dy(z.y,.4);float i=abs(z.y)-.1,n=y;n=min(n,x);n=max(n,-i);return n;}float fb(vec3 f){vec3 v=f;do(v,bf*q);dd(v.xz,D);float m=ed(v,u,o);vec3 y=f;do(y,bf*H);dd(y.xz,an);float s=ed(y,O,F);vec3 x=f;do(x,bf*R);dd(x.xz,Y);float z=ed(x,T,S);vec3 i=f;do(i,bf*ae);dd(i.xz,ak);float n=ed(i,G,B),d=da(m,s,z,n);return max(d,-ew(f.xz,W));}MatWrap fh(vec3 f,float v,float m){vec3 y=f;ej(y.zx,vec2(v));y.x+=v;float s=y.z;MatWrap x=MatWrap(s,eu(co,y));float z=y.z-j;MatWrap i=MatWrap(z,eu(cn,y));float n=y.y-m;MatWrap d=MatWrap(n,eu(cp,y));y.z-=j*.5;y.y-=m*.5;vec3 M=y;dn(M,atan(j/(ap*m)));float r=M.z,a=r;MatWrap c=MatWrap(r,eu(cm,M));vec3 e=y;float g=dd(e.x,V),l=fg(e.xy,ab);MatWrap t=MatWrap(l,eu(cq,e));vec2 S=vec2(r,l);float p=fg(S,Z);MatWrap h=MatWrap(p,eu(cr,vec3(S,0.)));vec3 b=e;b.z-=J;float o=ed(b,ad,ab.y);MatWrap w=MatWrap(o,eu(cs,b));vec3 u=vec3(e.x,M.yz);eh(u.x,.5*V);u.y-=k;float W=fc(u,af);MatWrap q=MatWrap(W,eu(cu,u)),I=c;I=et(I,x);I=eq(I,i);I=es(I,t);I=db(I,w,ai,3.,ct);I=eq(I,h);I=eq(I,q);I=et(I,d);return I;}MatWrap fc(vec3 f){f.y-=U.y;f.xz-=aj;f.xz-=h;float v=al/3.,m=fc(vec3(f.x,f.y-v,f.z),vec3(am,v,am));if(m>1.)return MatWrap(m,eu(cm,f));MatWrap y=fh(f,am,v);f.y-=v;float s=fa(f,v,bf*ao);MatWrap x=MatWrap(s,eu(ck,f));vec3 z=f;z.y-=aq;ej(z.xz,vec2(ar));float i=.5*ar*at;z.z-=-i;eh(z.z,i);float n=fa(z);MatWrap d=MatWrap(n,eu(cl,z)),M=eq(d,x);M.f=max(M.f,-f.y);M=eq(M,y);return M;}MatWrap fd(vec3 f){f.xz-=aj;f.x-=t;eh(f.z,as);ed(f.x,l);float v=fa(f);MatWrap m=MatWrap(v,eu(cw,f));return m;}MatWrap fe(vec3 f){vec3 v=f;v-=Q;dn(v,normalize(Q),length(Q));float m=fa(v,e,bf*c);MatWrap y=MatWrap(m,eu(cg,v));vec3 s=f;s-=a;dn(s,normalize(a),length(a));float x=fa(s,b,bf*r);MatWrap z=MatWrap(x,eu(ch,s));y=eq(y,z);vec3 i=f;i.xz-=aj;float n=ej(i.xz,U.xz,M),d=i.y-U.y*(1.-smoothstep(0.,L,n));MatWrap g=MatWrap(d,eu(ci,vec3(i.xz,n))),l=ds(y,g,A,cj);return l;}MatWrap ff(vec3 f){f.y-=U.y;f.xz-=aj;vec3 v=f;v.x-=U.x*d;eh(v.z,U.z);dn(v,normalize(vec3(-1.,0.,1.)),0.);float m=U.x*.5*n;v.x-=-m;vec3 i=v;eh(v.x,m);vec2 M=v.yz-z;float r=db(v.x,M.x,abs(M.y));MatWrap a=MatWrap(r,eu(cx,v));vec3 c=v;float e=fa(c,1./tan(bf*x)*s.x,bf*x);e=max(e,c.y-s.y);MatWrap g=MatWrap(e,eu(cy,c));i.x-=-m;dn(i,bf*ag);i.z-=y.z;float l=fc(i,y);MatWrap t=MatWrap(l,eu(cz,i));a=eq(a,g);a=eq(a,t);return a;}MatWrap fg(vec3 y){y.xz-=aj;vec3 s=y;ej(s.xz,vec2(0.));s.x-=m.x;s.z-=.5*du(m);float x=ep(s.z);s.z-=.5*(m.x-m.y);float z=x>0.?i:g,n=x>0.?E:v,d=fc(s,vec3(z,n,z));MatWrap M=MatWrap(d,eu(cm,s));if(d<1.)M=fh(s,z,n);vec3 r=s;eh(r.z,m.y*.5);float a=fc(r,f);MatWrap c=MatWrap(a,eu(cv,r));return eq(M,c);}float fh(vec3 f){return eq(fc(f)),eq(fd(f)),eq(fe(f)),eq(ff(f)),eq(fg(f)),bl;}float ft(vec3 f,bool v){bl=bi;bk=v;if(ce)eq(ez(f),eu(bv,f));if(cd)fh(f);return bl;}vec3 fu(vec3 f,float v){vec3 m[6]=vec3[6](vec3(v,0,0),vec3(0,v,0),vec3(0,0,v),vec3(-v,0,0),vec3(0,-v,0),vec3(0,0,-v));float y[6]=float[6](0,0,0,0,0,0);for(int s=0;s<6;s++)y[s]=ft(f+m[s],false);return vec3(y[0]-y[3],y[1]-y[4],y[2]-y[5]);}vec3 fv(vec3 f,float v){return normalize(fu(f,v));}vec3 fi(vec3 f){float v=max(5e-05,do(distance(f,az)));v*=br;return fi(f,v);}vec3 fw(vec3 f,vec3 v){vec3 m=fi(f);if(dot(v,m)>0.){m=normalize(dFdx(m)+m);if(dot(v,m)>0.)m=normalize(dFdy(m)+m);}return m;}vec3 fx(vec3 f,float v){return fu(f,v)/(2.*v);}vec3 fj(vec3 f){float v=max(5e-05,do(distance(f,az)));v*=br;return fj(f,v);}float da(vec3 f,vec3 v,float m,float y,float s,int x,float z,bool i){float n=m,d=bj,M=m,r=0,a=0,c=ei(ft(f,false));for(int e=0;e<x;++e){float g=c*ft(v*n+f,false),l=abs(g);bool t=z>1&&l+r<a;if(t)a-=z*a,z=1;else a=g*z;r=l;float S=l/n;if(!t&&S<d)M=n,d=S;if(!t&&S<s||n>y){break;}n+=a;}if((n>y||d>s)&&!i)return bj;return M;}float fi(vec3 f,vec3 v,float m){float y=da(f,v,.001,m,do(1),256,1.2,false);if(isinf(y))return y;for(int s=0;s<3;s++)y+=ft(f+y*v,false)-do(y);return y;}vec3 fj(vec3 f,vec3 v,float m){cd=by;ce=bz;float y=ft(f,false);vec3 s=fi(f);cd=bw;ce=bx;vec3 x=dFdx(f),z=dFdy(f);int i=5,n=5;vec3 d=vec3(0);for(int M=0;M<n;M++){for(int r=0;r<i;r++){vec2 a=(vec2(r,M)+.5)/vec2(i,n)-.5;vec3 c=a.x*x+a.y*z;float e=y+dot(s,c);d+=ff(e,v,m);}}return d/float(i*n);}vec3 fk(vec3 f,float v,vec3 m){return fj(m,f,v);}vec3 fk(vec3 f){cd=cb;ce=cc;vec3 v=fj(f);float m=length(v);cd=bw;ce=bx;vec3 y=vec3(.18014,.74453,.03288),s=vec3(.71547,.03995,.02537),x=vec3(1.);x=mix(x,y,1.-smoothstep(.8,1.,m));x=mix(x,s,smoothstep(1.,1.2,m));return x;}vec3 dc(vec3 f,float v,vec3 m,vec3 y,vec3 s,MaterialId x,Material z){vec3 i=z.emission;return fb(s,-m,z)+i;}vec3 ec(vec3 f,float v,vec3 m,vec3 y){return y;}Material fl(MaterialId f){Material v=eu(vec3(1));v.roughness=.1;vec3 m=vec3(165,87,69)/255.,y=vec3(100,90,81)/255.,s=vec3(185,164,136)/255.,x=vec3(199,190,174)/255.,z=vec3(133,131,119)/255.;v.color=x;if(f.id==ck||f.id==cm)v.color=s;else if(f.id==cn||f.id==co)v.color=y;else if(f.id==cu)v.color=m;else if(f.id==cv)v.color=z;else if(f.id==cq)v.color=z;else if(f.id==cr)v.color=y;else if(f.id==cs||f.id==ct)v.color=m;else if(f.id==cl)v.color=y;return v;}void main(){db();vec3 f=az,v=da();float m=fi(f,v,cf);if(isinf(m))au=fc(f,v,cf),av=cf;else{vec3 y=f+m*v;float s=ft(y,true);MaterialId x=bm;vec3 z=fw(y,v);if(x.id==bv){vec3 i=fk(f,m,y);if(ca){vec3 n=fk(y);i=mix(i,n,.5);}Material n=eu(i);n.roughness=1.;au=fb(z,-v,n);}else{if(ca){vec3 i=fk(y);Material n=eu(i);n.roughness=0.;au=fb(z,-v,n);}else{Material i=fl(x);i.roughness=dz(i.roughness);au=dc(f,m,v,y,z,x,i);}}av=m;}au=ec(f,m,v,au);au*=exp2(X);};
#endif
