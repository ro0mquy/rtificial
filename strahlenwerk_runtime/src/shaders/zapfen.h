#ifndef zapfen_H
#define zapfen_H
const char zapfen_source[] = R"shader_source(#version 430
layout(location=0)uniform vec2 y;layout(location=0)out vec3 v;layout(location=1)out float f;layout(location=2)out float r;layout(location=17)uniform float m;layout(location=5)uniform float x;
#define FOCAL_LENGTH
layout(location=1)uniform float d;
#line 1
layout(location=2)uniform vec3 z;layout(location=3)uniform vec4 c;layout(location=4)uniform float l;
#ifndef FOCAL_LENGTH
layout(location=5)uniform float s;
#endif
float n=6.28319;struct Material{vec3 color;float roughness;float metallic;};struct SphereLight{vec3 center;vec3 color;float radius;float intensity;};
#line 4
layout(location=35)uniform vec3 i;layout(location=36)uniform float w;bool u=false,a=false;void t(vec3 m,float x){float z=z,l=s,n=d;r=(x-z)/x*(l*l)/(n*(z-l))/.03*y.x;v=m;f=log(max(dot(m,vec3(.2126,.7152,.0722)),1e-06));}vec3 p(vec3 y,vec4 v){vec3 f=2*cross(v.xyz,y);return y+v.w*f+cross(v.xyz,f);}vec3 p(){vec3 v=normalize(vec3((gl_FragCoord.xy-.5*y)/y.x,-s/.03));return p(v,c);}float h(vec3 v,float y){return length(v)-y;}float h(vec3 v,vec3 y,vec3 f,float x){vec3 z=v-y,l=f-y;float m=clamp(dot(z,l)/dot(l,l),0.,1.);return length(z-l*m)-x;}float e(vec3 v,vec2 y){vec2 z=vec2(length(v.xz)-y.x,v.y);return length(z)-y.y;}float F(vec3 v,vec3 y){return v=abs(v)-y,max(v.x,max(v.y,v.z));}float g(vec2 v,vec2 y){return v=abs(v)-y,max(v.x,v.y);}float M(vec3 v,vec3 y){vec3 f=abs(v)-y;return min(max(f.x,max(f.y,f.z)),0.)+length(max(f,0.));}float F(vec3 v,vec3 f,float y){return M(v,f-y)-y;}float S(vec3 v,vec2 y){float f=length(v.xy);return dot(y,vec2(f,v.z));}float o(vec3 v,vec3 y){return dot(v,y.xyz);}vec2 b(vec2 v,vec2 y){return mix(v,y,float(v.x>y.x));}float M(float y,float v,float x){float f=clamp(.5+.5*(v-y)/x,0.,1.);return mix(v,y,f)-x*f*(1.-f);}vec2 S(vec2 v,vec2 y,float f){return vec2(M(v,y,f),v.x>y.x?y.y:v.y);}vec2 b(vec2 y,vec2 v,float x){float f=clamp(.5+.5*(v-y)/x,0.,1.);return vec2(mix(v.x,y.x,f)-x*f*(1.-f),mix(v.y,y.y,f));}float e(float y,float v,float x){float f=clamp(.5-.5*(v-y)/x,0.,1.);return mix(v,y,f)+x*f*(1.-f);}float L(vec3 v,vec3 y){return max(0.,dot(v,y));}float F(float y){return y*y;}vec3 F(vec3 v,vec3 y,vec3 f,Material m,SphereLight l){vec3 z=l.center-v,x=reflect(-f,y),n=dot(z,x)*x-z,d=z+n*clamp(l.radius/length(n),0.,1.),c=normalize(d);float w=distance(v,l.center),s=acos(-1.);vec3 i=.5*(c+f);float r=dot(y,i),a=L(y,c),Y=dot(y,f),u=F(m.roughness),k=F(u),o=F(m.roughness+1.),M=k/(4.*mix(a,1.,o)*mix(Y,1.,o)*s*F(F(r)*(k-1.)+1.)),Q=clamp(u+l.radius*.5/w,0.,1.),e=k/(Q*Q),K=dot(f,i),S=exp2((-5.55473*K-6.98316)*K),b=.04+.96*S;vec3 p=m.color+(1.-m.color)*S,E=.5*(m.color/s+M*b),t=M*p;float g=F(1.-F(F(w/l.radius))),W=clamp(g,0.,1.)/(F(w)+1.);return a*mix(E,t,m.metallic)*W*l.intensity*l.color*e;}vec3 C(vec3 y,float x){return y*x;}vec3 T(vec3 v,vec3 y){return mod(v,y)-.5*y;}vec3 C(vec3 v,float y,float f,float x){return T(v,vec3(y,f,x));}vec3 O(vec3 y,vec3 x){return y-x;}vec3 F(vec3 v,float y,float f,float x){return O(v,vec3(y,f,x));}mat3 C(float v){return mat3(1.,0.,0.,0.,cos(v),sin(v),0.,-sin(v),cos(v));}mat3 L(float v){return mat3(cos(v),0.,-sin(v),0.,1.,0.,sin(v),0.,cos(v));}mat3 M(float v){return mat3(cos(v),sin(v),0.,-sin(v),cos(v),0.,0.,0.,1.);}mat2 O(float v){return mat2(cos(v),-sin(v),sin(v),cos(v));}float N(float v,float y){const float x=v*y;return x*exp(1.-x);}float C(float y,float v,float f){return clamp((f-y)/(v-y),0.,1.);}float N(float v){return v-floor(v*(1./289.))*289.;}vec2 S(vec2 v){return v-floor(v*(1./289.))*289.;}vec3 T(vec3 v){return v-floor(v*(1./289.))*289.;}vec4 b(vec4 v){return v-floor(v*(1./289.))*289.;}float e(float v){return b((v*34.+1.)*v);}vec2 g(vec2 v){return b((v*34.+1.)*v);}vec3 h(vec3 v){return b((v*34.+1.)*v);}vec4 o(vec4 v){return b((v*34.+1.)*v);}vec4 p(vec4 y){return 1.79284-.853735*y;}vec2 t(vec2 v){return v*v*v*(v*(v*6.-15.)+10.);}vec3 H(vec3 v){return v*v*v*(v*(v*6.-15.)+10.);}float G(vec2 v){vec4 y=floor(v.xyxy)+vec4(0.,0.,1.,1.),f=fract(v.xyxy)-vec4(0.,0.,1.,1.);y=b(y);vec4 x=y.xzxz,z=y.yyww,l=f.xzxz,n=f.yyww,m=o(o(x)+z),d=fract(m*(1./41.))*2.-1.,c=abs(d)-.5,s=floor(d+.5);d=d-s;vec2 r=vec2(d.x,c.x),w=vec2(d.y,c.y),i=vec2(d.z,c.z),a=vec2(d.w,c.w);vec4 k=p(vec4(dot(r,r),dot(i,i),dot(w,w),dot(a,a)));r*=k.x;i*=k.y;w*=k.z;a*=k.w;float u=dot(r,vec2(l.x,n.x)),Y=dot(w,vec2(l.y,n.y)),Q=dot(i,vec2(l.z,n.z)),K=dot(a,vec2(l.w,n.w));vec2 M=H(f.xy),E=mix(vec2(u,Q),vec2(Y,K),M.x);float e=mix(E.x,E.y,M.y);return 2.3*e;}float E(vec3 v){vec3 f=floor(v),y=f+vec3(1.);f=b(f);y=b(y);vec3 x=fract(v),l=x-vec3(1.);vec4 z=vec4(f.x,y.x,f.x,y.x),n=vec4(f.yy,y.yy),c=f.zzzz,d=y.zzzz,m=o(o(z)+n),k=o(m+c),s=o(m+d),r=k*(1./7.),i=fract(floor(r)*(1./7.))-.5;r=fract(r);vec4 w=vec4(.5)-abs(r)-abs(i),a=step(w,vec4(0.));r-=a*(step(0.,r)-.5);i-=a*(step(0.,i)-.5);vec4 Q=s*(1./7.),K=fract(floor(Q)*(1./7.))-.5;Q=fract(Q);vec4 E=vec4(.5)-abs(Q)-abs(K),M=step(E,vec4(0.));Q-=M*(step(0.,Q)-.5);K-=M*(step(0.,K)-.5);vec3 u=vec3(r.x,i.x,w.x),Y=vec3(r.y,i.y,w.y),e=vec3(r.z,i.z,w.z),S=vec3(r.w,i.w,w.w),t=vec3(Q.x,K.x,E.x),g=vec3(Q.y,K.y,E.y),W=vec3(Q.z,K.z,E.z),h=vec3(Q.w,K.w,E.w);vec4 F=p(vec4(dot(u,u),dot(e,e),dot(Y,Y),dot(S,S)));u*=F.x;e*=F.y;Y*=F.z;S*=F.w;vec4 T=p(vec4(dot(t,t),dot(W,W),dot(g,g),dot(h,h)));t*=T.x;W*=T.y;g*=T.z;h*=T.w;float O=dot(u,x),L=dot(Y,vec3(l.x,x.yz)),C=dot(e,vec3(x.x,l.y,x.z)),N=dot(S,vec3(l.xy,x.z)),G=dot(t,vec3(x.xy,l.z)),A=dot(g,vec3(l.x,x.y,l.z)),Z=dot(W,vec3(x.x,l.yz)),X=dot(h,l);vec3 R=H(x);vec4 V=mix(vec4(O,L,C,N),vec4(G,A,Z,X),R.z);vec2 U=mix(V.xy,V.zw,R.y);float P=mix(U.x,U.y,R.x);return 2.2*P;}float A(vec2 v){vec2 y=b(v),f=o(y);return fract(o(f.x*f.y+y.x+y.y)/41.)*2.-1.;}float k(vec3 v){vec3 y=b(v),f=o(y);return fract(o(f.x*f.y*f.z+y.x+y.y+y.z)/41.)*2.-1.;}float Z(vec2 v){vec2 f=floor(v),y=fract(v),l=vec2(1.,0.);float x=k(f+l.yy),z=k(f+l.yx),n=k(f+l.xy),w=k(f+l.xx);y=H(y);return mix(mix(x,n,y.x),mix(z,w,y.x),y.y);}float Y(vec3 v){vec3 f=floor(v),y=fract(v);vec2 l=vec2(1.,0.);float x=k(f+l.yyy),z=k(f+l.yyx),m=k(f+l.yxy),n=k(f+l.yxx),w=k(f+l.xyy),d=k(f+l.xyx),c=k(f+l.xxy),i=k(f+l.xxx);y=H(y);return mix(mix(mix(x,w,y.x),mix(m,c,y.x),y.y),mix(mix(z,d,y.x),mix(n,i,y.x),y.y),y.z);}float X(vec2 v){return(E(v)+E(v*2.)*.5+E(v*4.)*.25)/1.75;}float W(vec3 v){return(E(v)+E(v*2.)*.5+E(v*4.)*.25)/1.75;}float V(vec2 v){return(Y(v)+Y(v*2.)*.5+Y(v*4.)*.25)/1.75;}float U(vec3 v){return(Y(v)+Y(v*2.)*.5+Y(v*4.)*.25)/1.75;}vec3 R(vec3 v){return F(v,0.,10.*(Y(.05*v.xz)*.5+.5),0.);}float Q(vec3 v){return R(v).y;}float P(vec3 v){vec2 y=vec2(.01,0.);vec3 f=vec3(Q(v+y.xyy)-Q(v-y.xyy),Q(v+y.yxy)-Q(v-y.yxy),Q(v+y.yxx)-Q(v-y.yxx));return Q(v)/length(f)*2.*y.x;}vec2 A(vec3 v,float y,float x){vec2 f=floor(v.xz/50.)*50.,d=ceil(v.xz/50.)*50.,z=f;if(abs(v.x-f.x)>abs(v.x-d.x))z.x=d.x;if(abs(v.y-f.y)>abs(v.y-d.y))z.y=d.y;float m=smoothstep(.2,.8,Y(vec2(distance(z,v.xz)*.5+1.3*l,2000.*k(floor((v.xz+25.)/50.))))),n=Y(.7*v.xz+333.*x)*.5+.5;v.xz+=O(radians(20.)*n)*vec2(10.)-10.;v=F(v,0.,4.*(n*.5+.5),0.);v.x=mod(v.x,10./x)-5./x;return vec2(length(v.xy)-y,m);}vec2 K(vec3 v){vec2 y=vec2(-h(z-v,1000.),0.);float x=40.;vec3 f=T(v,vec3(50.));f.y=v.y-x;float m=smoothstep(-x*1.2,x,-f.y);vec2 d=floor(v.xz/50.);f.xz+=k(d+10.)*5.;float n=sin(7.*dot(d,d)+l*.5),c=cos(11.*dot(d,d)+l*.5);mat3 r=C(n*(1.-m)*radians(7.)),s=M(c*(1.-m)*radians(7.)),i=L((1.-m)*radians(100.));f=s*r*i*f;float w=10.*m,E=max(length(f.xz)-w,abs(f.y)-x);if(a)E+=.06*W((2.*Y(f)+f)*.5);vec2 t=vec2(E,1.);if(u){vec2 K=vec2(Q(v),2.),g=b(t,K,10.),p;if(v.y<20.){vec3 S=R(v);vec2 O=A(S,.2,1.7),o=A(L(radians(50.))*S,.2,2.3),G=A(L(radians(30.))*S,.2,3.2),N=A(L(radians(70.))*S,.2,2.7);p=b(b(O,o),b(G,N));p.y+=3.;}else p=vec2(v.y,3.);t=b(g,p);}else t=vec2(e(t.x,20.-v.y,2.),1.);return b(y,t);}vec3 A(vec3 v,vec3 y,out int f,int x,float z){float r=0.;for(f=0;f<x;f++){float m=K(v)[0]*z;v+=y*m;m=abs(m);r+=m;if(m<.001*r)break;}return v;}vec3 E(vec3 v,vec3 y,out int x){return A(v,y,x,100,1.);}vec3 J(vec3 v){vec2 y=vec2(.001,0.);return normalize(vec3(K(v+y.xyy)[0]-K(v-y.xyy)[0],K(v+y.yxy)[0]-K(v-y.yxy)[0],K(v+y.yyx)[0]-K(v-y.yyx)[0])+1e-09);}void main(){vec3 v=p();int y;vec3 f=A(z,v,y,150,.9);if(abs(K(f)[1])<=1e-06){if(v.y!=0){float m=-(z.y-20.)/v.y;if(m>0.)u=true,f=A(z+m*v,v,y,20,.8);}}float m=K(f)[1];vec3 x=vec3(0.);a=true;vec3 n=J(f);SphereLight d=SphereLight(vec3(0.,1000.,10.),vec3(1.),3.,10000.);if(m==0.)x+=.01*i;else if(m>=1.&&m<=2.){Material c=Material(vec3(0.),1.,0.);vec3 r=F(f,n,-v,c,d);Material S=Material(vec3(0.),1.,0.);vec3 E=F(f,n,-v,S,d);float Q=1.;vec3 Y=f;float s=radians(5.)*Y.y*sin(l+Y.y)+radians(5.)*w*10.*sin(Y.x+l)*cos(Y.z+l*2.);Y.xz*=mat2(cos(s),sin(s),-sin(s),cos(s));float M=.01*(sin(length(Y.xz)*.1-3.*l)*.5+.5);Y.xz=mod(Y.xz,30.);Q=step(Y.x,.5)+step(Y.z,.5);x=mix(r,E,m-1.);}else if(m>=3.&&m<=4.){Material c=Material(vec3(1.,0.,0.),1.,0.);vec3 r=vec3(0.),E=F(f,n,-v,c,d);x=mix(r,E,m-3.);}t(x,distance(z,f));})shader_source";
#endif
