#ifndef zapfen_H
#define zapfen_H
const char zapfen_source[] = R"shader_source(#version 430
layout(location=0)uniform vec2 y;layout(location=0)out vec3 v;layout(location=1)out float f;layout(location=16)uniform float m;layout(location=6)uniform float x;
#define FOCAL_LENGTH
layout(location=2)uniform float d;
#line 1
layout(location=3)uniform vec3 l;layout(location=4)uniform vec4 z;layout(location=5)uniform float s;
#ifndef FOCAL_LENGTH
layout(location=6)uniform float c;
#endif
float n=6.28319;struct Material{vec3 color;float roughness;float metallic;};struct SphereLight{vec3 center;vec3 color;float radius;float intensity;};
#line 4
layout(location=37)uniform vec3 r;layout(location=38)uniform float i;layout(location=39)uniform float e;layout(location=40)uniform vec3 w;layout(location=41)uniform vec3 a;layout(location=42)uniform float F;layout(location=43)uniform float S;layout(location=44)uniform float M;layout(location=45)uniform vec3 g;layout(location=46)uniform vec3 k;layout(location=47)uniform vec3 o;layout(location=48)uniform vec3 t;layout(location=49)uniform float u;layout(location=50)uniform float p;bool b=false,h=false;void L(vec3 x,float l){float z=z,s=c,n=d;f=(l-z)/l*(s*s)/(n*(z-s))/.03*y.x;v=x;}vec3 C(vec3 y,vec4 v){vec3 f=2*cross(v.xyz,y);return y+v.w*f+cross(v.xyz,f);}vec3 C(){vec3 v=normalize(vec3((gl_FragCoord.xy-.5*y)/y.x,-c/.03));return C(v,z);}float T(vec3 v,float y){return length(v)-y;}float C(vec3 v,vec3 y,vec3 f,float x){vec3 l=v-y,z=f-y;float n=clamp(dot(l,z)/dot(z,z),0.,1.);return length(l-z*n)-x;}float O(vec3 v,vec2 y){vec2 l=vec2(length(v.xz)-y.x,v.y);return length(l)-y.y;}float N(vec3 v,vec3 y){return v=abs(v)-y,max(v.x,max(v.y,v.z));}float H(vec2 v,vec2 y){return v=abs(v)-y,max(v.x,v.y);}float G(vec3 v,vec3 y){vec3 f=abs(v)-y;return min(max(f.x,max(f.y,f.z)),0.)+length(max(f,0.));}float C(vec3 v,vec3 f,float y){return G(v,f-y)-y;}float E(vec3 v,vec2 y){float l=length(v.xy);return dot(y,vec2(l,v.z));}float A(vec3 v,vec3 y){return dot(v,y.xyz);}vec2 Z(vec2 v,vec2 y){return mix(v,y,float(v.x>y.x));}float A(float y,float v,float x){float f=clamp(.5+.5*(v-y)/x,0.,1.);return mix(v,y,f)-x*f*(1.-f);}vec2 E(vec2 v,vec2 f,float y){return vec2(A(v,f,y),v.x>f.x?f.y:v.y);}vec2 G(vec2 y,vec2 v,float x){float f=clamp(.5+.5*(v-y)/x,0.,1.);return vec2(mix(v.x,y.x,f)-x*f*(1.-f),mix(v.y,y.y,f));}float H(float y,float v,float x){float f=clamp(.5-.5*(v-y)/x,0.,1.);return mix(v,y,f)+x*f*(1.-f);}float Y(vec3 v,vec3 y){return max(0.,dot(v,y));}float A(float y){return y*y;}vec3 A(vec3 v,vec3 y,vec3 f,Material l,SphereLight m){vec3 x=m.center-v,z=reflect(-f,y),s=dot(x,z)*z-x,n=x+s*clamp(m.radius/length(s),0.,1.),d=normalize(n);float a=distance(v,m.center),c=acos(-1.);vec3 i=.5*(d+f);float r=dot(y,i),g=Y(y,d),w=dot(y,f),D=A(l.roughness),J=A(D),S=A(l.roughness+1.),M=J/(4.*mix(g,1.,S)*mix(w,1.,S)*c*A(A(r)*(J-1.)+1.)),h=clamp(D+m.radius*.5/a,0.,1.),e=J/(h*h),p=dot(f,i),o=exp2((-5.55473*p-6.98316)*p),b=.04+.96*o;vec3 F=l.color+(1.-l.color)*o,u=.5*(l.color/c+M*b),t=M*F;float k=A(1.-A(A(a/m.radius))),q=clamp(k,0.,1.)/(A(a)+1.);return g*mix(u,t,l.metallic)*q*m.intensity*m.color*e;}vec3 X(vec3 y,float x){return y*x;}vec3 W(vec3 v,vec3 y){return mod(v,y)-.5*y;}vec3 A(vec3 v,float y,float f,float x){return W(v,vec3(y,f,x));}vec3 V(vec3 v,vec3 y){return v-y;}vec3 E(vec3 v,float y,float f,float x){return V(v,vec3(y,f,x));}mat3 C(float v){return mat3(1.,0.,0.,0.,cos(v),sin(v),0.,-sin(v),cos(v));}mat3 E(float v){return mat3(cos(v),0.,-sin(v),0.,1.,0.,sin(v),0.,cos(v));}mat3 G(float v){return mat3(cos(v),sin(v),0.,-sin(v),cos(v),0.,0.,0.,1.);}mat2 H(float v){return mat2(cos(v),-sin(v),sin(v),cos(v));}float U(float v,float y){const float x=v*y;return x*exp(1.-x);}float L(float y,float v,float f){return clamp((f-y)/(v-y),0.,1.);}float L(float v){return v-floor(v*(1./289.))*289.;}vec2 N(vec2 v){return v-floor(v*(1./289.))*289.;}vec3 O(vec3 v){return v-floor(v*(1./289.))*289.;}vec4 T(vec4 v){return v-floor(v*(1./289.))*289.;}float U(float v){return T((v*34.+1.)*v);}vec2 V(vec2 v){return T((v*34.+1.)*v);}vec3 W(vec3 v){return T((v*34.+1.)*v);}vec4 X(vec4 v){return T((v*34.+1.)*v);}vec4 Y(vec4 y){return 1.79284-.853735*y;}vec2 Z(vec2 v){return v*v*v*(v*(v*6.-15.)+10.);}vec3 R(vec3 v){return v*v*v*(v*(v*6.-15.)+10.);}float Q(vec2 v){vec4 f=floor(v.xyxy)+vec4(0.,0.,1.,1.),l=fract(v.xyxy)-vec4(0.,0.,1.,1.);f=T(f);vec4 y=f.xzxz,x=f.yyww,n=l.xzxz,m=l.yyww,s=X(X(y)+x),z=fract(s*(1./41.))*2.-1.,d=abs(z)-.5,a=floor(z+.5);z=z-a;vec2 r=vec2(z.x,d.x),w=vec2(z.y,d.y),i=vec2(z.z,d.z),c=vec2(z.w,d.w);vec4 J=Y(vec4(dot(r,r),dot(i,i),dot(w,w),dot(c,c)));r*=J.x;i*=J.y;w*=J.z;c*=J.w;float D=dot(r,vec2(n.x,m.x)),S=dot(w,vec2(n.y,m.y)),p=dot(i,vec2(n.z,m.z)),h=dot(c,vec2(n.w,m.w));vec2 M=R(l.xy),g=mix(vec2(D,p),vec2(S,h),M.x);float e=mix(g.x,g.y,M.y);return 2.3*e;}float P(vec3 v){vec3 f=floor(v),y=f+vec3(1.);f=T(f);y=T(y);vec3 l=fract(v),z=l-vec3(1.);vec4 x=vec4(f.x,y.x,f.x,y.x),n=vec4(f.yy,y.yy),s=f.zzzz,d=y.zzzz,m=X(X(x)+n),c=X(m+s),J=X(m+d),r=c*(1./7.),i=fract(floor(r)*(1./7.))-.5;r=fract(r);vec4 a=vec4(.5)-abs(r)-abs(i),M=step(a,vec4(0.));r-=M*(step(0.,r)-.5);i-=M*(step(0.,i)-.5);vec4 w=J*(1./7.),h=fract(floor(w)*(1./7.))-.5;w=fract(w);vec4 S=vec4(.5)-abs(w)-abs(h),p=step(S,vec4(0.));w-=p*(step(0.,w)-.5);h-=p*(step(0.,h)-.5);vec3 D=vec3(r.x,i.x,a.x),g=vec3(r.y,i.y,a.y),u=vec3(r.z,i.z,a.z),b=vec3(r.w,i.w,a.w),o=vec3(w.x,h.x,S.x),e=vec3(w.y,h.y,S.y),t=vec3(w.z,h.z,S.z),k=vec3(w.w,h.w,S.w);vec4 F=Y(vec4(dot(D,D),dot(u,u),dot(g,g),dot(b,b)));D*=F.x;u*=F.y;g*=F.z;b*=F.w;vec4 Z=Y(vec4(dot(o,o),dot(t,t),dot(e,e),dot(k,k)));o*=Z.x;t*=Z.y;e*=Z.z;k*=Z.w;float P=dot(D,l),q=dot(g,vec3(z.x,l.yz)),L=dot(u,vec3(l.x,z.y,l.z)),C=dot(b,vec3(z.xy,l.z)),O=dot(o,vec3(l.xy,z.z)),N=dot(e,vec3(z.x,l.y,z.z)),H=dot(t,vec3(l.x,z.yz)),G=dot(k,z);vec3 W=R(l);vec4 V=mix(vec4(P,q,L,C),vec4(O,N,H,G),W.z);vec2 E=mix(V.xy,V.zw,W.y);float A=mix(E.x,E.y,W.x);return 2.2*A;}float K(vec2 v){vec2 y=T(v),f=X(y);return fract(X(f.x*f.y+y.x+y.y)/41.)*2.-1.;}float J(vec3 v){vec3 y=T(v),f=X(y);return fract(X(f.x*f.y*f.z+y.x+y.y+y.z)/41.)*2.-1.;}float I(vec2 v){vec2 f=floor(v),y=fract(v),n=vec2(1.,0.);float l=J(f+n.yy),z=J(f+n.yx),x=J(f+n.xy),d=J(f+n.xx);y=R(y);return mix(mix(l,x,y.x),mix(z,d,y.x),y.y);}float D(vec3 v){vec3 f=floor(v),y=fract(v);vec2 n=vec2(1.,0.);float l=J(f+n.yyy),z=J(f+n.yyx),x=J(f+n.yxy),d=J(f+n.yxx),w=J(f+n.xyy),m=J(f+n.xyx),S=J(f+n.xxy),c=J(f+n.xxx);y=R(y);return mix(mix(mix(l,w,y.x),mix(x,S,y.x),y.y),mix(mix(z,m,y.x),mix(d,c,y.x),y.y),y.z);}float B(vec2 v){return(P(v)+P(v*2.)*.5+P(v*4.)*.25)/1.75;}float q(vec3 v){return(P(v)+P(v*2.)*.5+P(v*4.)*.25)/1.75;}float j(vec2 v){return(D(v)+D(v*2.)*.5+D(v*4.)*.25)/1.75;}float ab(vec3 v){return(D(v)+D(v*2.)*.5+D(v*4.)*.25)/1.75;}vec3 B(vec3 v,vec3 y,vec3 f,Material x){vec3 r=vec3(0.);r+=A(v,y,f,x,SphereLight(g,o,u,p));r+=A(v,y,f,x,SphereLight(k,t,u,p));return r;}vec3 ac(vec3 v){return E(v,0.,10.*(D(.05*v.xz)*.5+.5),0.);}float ad(vec3 v){return ac(v).y;}float ae(vec3 v){vec2 y=vec2(.01,0.);vec3 f=vec3(ad(v+y.xyy)-ad(v-y.xyy),ad(v+y.yxy)-ad(v-y.yxy),ad(v+y.yxx)-ad(v-y.yxx));return ad(v)/length(f)*2.*y.x;}vec2 D(vec3 v,float y,float f,float x){vec2 n=floor(v.xz/50.)*50.,d=ceil(v.xz/50.)*50.,l=n;if(abs(v.x-n.x)>abs(v.x-d.x))l.x=d.x;if(abs(v.y-n.y)>abs(v.y-d.y))l.y=d.y;v.xz*=H(y);float z=smoothstep(.2,.8,D(vec2(distance(l,v.xz)*.5+1.3*s,2000.*J(floor((v.xz+25.)/50.))))),m=D(v.xz*e+333.*x)*.5+.5;v.xz+=H(radians(10.)*m)*vec2(10.)-10.;v=E(v,0.,4.*(m*.5+.5),0.);vec3 r=v;r.xz=mod(r.xz,40.);float w=atan(r.x,r.z);w=mod(w,radians(20.));float a=length(r.xz);r.x=a*sin(w);return vec2(length(r.xy)-f,z);}vec2 af(vec3 v){vec2 y=vec2(-T(l-v,1000.),0.);float f=40.;vec3 r=W(v,vec3(50.));r.y=v.y-f;float x=smoothstep(-f*1.2,f,-r.y);vec2 z=floor(v.xz/50.);r.xz+=J(z+10.)*5.;float n=sin(7.*dot(z,z)+s*.5),d=cos(11.*dot(z,z)+s*.5);mat3 m=C(n*(1.-x)*radians(7.)),c=G(d*(1.-x)*radians(7.)),S=E((1.-x)*radians(100.));r=c*m*S*r;float a=10.*x,w=max(length(r.xz)-a,abs(r.y)-f);if(h)w+=.06*q((2.*D(r)+r)*.5);vec2 i=vec2(w,1.);if(b){vec2 M=vec2(ad(v),2.),g=G(i,M,10.),e;if(v.y<20.){vec3 k=ac(v);e.y=1.;vec2 u=D(k,0.,.6,1.7),p=D(k,50.,.6,2.3),o=D(k,20.,.6,3.2),t=D(k,80.,.6,2.7);e=Z(Z(u,p),Z(o,t));e.y+=3.;}else e=vec2(v.y,3.);i=Z(g,e);}else i=vec2(H(i.x,20.-v.y,2.),1.);return Z(y,i);}vec3 B(vec3 v,vec3 y,out int f,int x,float z){float r=0.;for(f=0;f<x;f++){float l=af(v)[0]*z;v+=y*l;l=abs(l);r+=l;if(l<.001*r)break;}return v;}vec3 B(vec3 v,vec3 y,out int f){return B(v,y,f,100,1.);}vec3 ag(vec3 v){vec2 y=vec2(.001,0.);return normalize(vec3(af(v+y.xyy)[0]-af(v-y.xyy)[0],af(v+y.yxy)[0]-af(v-y.yxy)[0],af(v+y.yyx)[0]-af(v-y.yyx)[0])+1e-09);}float G(vec3 v,vec3 y,float f,float l){float x,z=sign(f);for(x=z*.5+.5;l>0;l--)x-=(l*f-af(v+y*l*f*z)[0])/exp2(l);return x;}void main(){vec3 v=C();int y;vec3 f=B(l,v,y,150,.9);if(abs(af(f)[1])<=1e-06){if(v.y!=0){float n=-(l.y-20.)/v.y;if(n>0.)b=true,f=B(l+n*v,v,y,20,.7);}}float z=af(f)[1];vec3 x=vec3(0.);h=true;vec3 n=ag(f);if(z==0.)x+=.01*r;else if(z>=1.&&z<=2.){Material m=Material(w,S,0.),d=Material(a,M,0.);float a=pow(smoothstep(-80.,-20.,-f.y),7.)*smoothstep(.3,.9,q(f*F*vec3(D(.2*f+7.)*.01+1.,.3,D(.2*f+3.)*.01+1.))*.5+.5);vec3 k=mix(B(f,n,-v,m),B(f,n,-v,d),a);Material c=Material(vec3(0.),1.,0.);vec3 e=B(f,n,-v,c);float g=1.;vec3 J=f;float u=radians(5.)*J.y*sin(s+J.y)+radians(5.)*i*10.*sin(J.x+s)*cos(J.z+s*2.);J.xz*=mat2(cos(u),sin(u),-sin(u),cos(u));float p=.01*(sin(length(J.xz)*.1-3.*s)*.5+.5);J.xz=mod(J.xz,30.);g=step(J.x,.5)+step(J.z,.5);x=mix(k,e,z-1.);}else if(z>=3.&&z<=4.){Material m=Material(vec3(1.,0.,0.),1.,0.);vec3 a=vec3(0.),d=B(f,n,-v,m);x=mix(a,d,z-3.);}L(x,distance(l,f));})shader_source";
#endif
